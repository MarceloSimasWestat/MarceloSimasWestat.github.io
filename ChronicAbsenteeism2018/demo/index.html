<!DOCTYPE html>
<!--
    Hyperspace by Pixelarity
    pixelarity.com @pixelarity
    License: pixelarity.com/license
-->
<html lang="en-us">
<head>
    <title>Chronic Absenteeism in the Nation's Schools - DRAFT</title>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/map.css" />
	    <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->

    <!--<link rel="stylesheet" href="widgets.css" />-->
    <!-- <link rel="stylesheet" href="assets/css/chart-styles.css" /> -->

    <!-- browser tab icon (aka favicon) -->
    <link rel="icon" href="images/doelogo_rev.png" />

    <!-- Scripts -->
    <!--<script src="widgets.js"></script>-->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
    <script src="assets/js/main.js"></script>

    <!-- Substitutes high-res images for Retina displays (html file only) -->
    <script type="text/javascript" src="assets/js/retina.js"></script>

    <script src="assets/js/d3.v3.min.js"></script>
    <script src="assets/js/d3-tip.js"></script>
    <script src="assets/js/queue.v1.min.js"></script>
    <script src="assets/js/topojson.v1.min.js"></script>

</head>
<body>

    <div id="loader-wrapper">
        <div id="loader"></div>
        <div class="loader-section"></div>
    </div>

    <!-- Sidebar -->
    <section id="sidebar">
        <div class="inner">

            <div class="nav-image">
                <img src="images/edsealbw.svg" alt="Department of Learning" />
            </div>

            <div class="nav-wrapper">
                <nav>
                    <ul>
                        <li><a href="#intro">Introduction</a></li>
                        <li><a href="#one">Who is Impacted</a></li>
                        <li><a href="#two">Unstable Pathways</a></li>
                        <li><a href="#three">Chronic Absence Mapped</a></li>
                        <li><a href="#four">Why It Matters</a></li>
                    </ul>
                </nav>
                <ul class="icons socialmedia" style="margin-bottom: 0;">
                    <li><a href="#" target="_blank" title="Tweet" class="fa-twitter"><span class="label">Twitter</span></a></li>
                    <li><a href="#" target="_blank" title="Share on Facebook" class="fa-facebook"><span class="label">Facebook</span></a></li>
                    <li><a href="#" target="_blank" title="Share on LinkedIn" class="fa-linkedin"><span class="label">LinkedIn</span></a></li>
                    <li><a href="#" target="_blank" title="Email" class="fa-envelope"><span class="label">Email</span></a></li>
                </ul>
            </div>

            <!-- Given Flex, this allows the social media icons to be paired with the navigation links without hugging the bottom -->
            <div>
                &nbsp;
            </div>
        </div>
    </section>

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Intro 1 -->
        <section id="intro" class="wrapper style1 fullscreen fade-up">
            <div class="inner">
                <h1 style="max-width: 650px;">CHRONIC ABSENTEEISM IN THE NATION'S SCHOOLS<br></h1>
                <p style="font-size:15pt">A hidden educational crisis.</p>
                <ul class="actions">
                    <li><span class="buttonInactive">— U.S. Department of Education</span></li>
                </ul>
                <p style="font-size:15pt">DRAFT</p>
            </div>
        </section>

        <!-- InformED Shouout -->

        <section class="wrapper style5">
            <div class="inner align-center" style="padding-top: 40px; padding-bottom: 20px;">
                <div>
                    <i class="fa fa-bolt fa-lg" style="margin-bottom: 1em; color: rgba(255,255,255,1);"></i>
                </div>
                <p>Powered by InformED and the <a href="http://www2.ed.gov/about/offices/list/ocr/docs/crdc-2015-16.html">2015-16 Civil Rights Data Collection.</a></p>
            </div>
        </section>

        <!-- Intro 2 -->
        <section class="wrapper style3">
            <div class="inner">
                <div class="align-right">
                    <div style="margin-bottom: 2.5em;">
                        <input type="checkbox" id="highContrast" name="highContrast">
                        <label for="highContrast">Enable High Contrast (508)</label>
                    </div>
                </div>
                <h2 class="line">Data Illuminates the Extent of Chronic Absenteeism</h2>
                <p class="afterHeader">
                    Education can only fulfill its promise as the great equalizer—a force that can overcome differences in privilege and background—when we work to ensure that students are in school every day and receive the supports they need to learn and thrive.
                </p>
                <p>
                    At the same time, we know that many students experience tremendous adversity in their lives—including poverty, health challenges, community violence, and difficult family circumstances—that make it difficult for them to take advantage of the opportunity to learn at school.
                </p>
                <p style="margin-bottom:3.5em;">
                    Students who are chronically absent—meaning they miss at least 15 days of school in a year—are at serious risk of falling behind in school. Yet, for too long, this crisis in our nation’s public elementary and secondary schools has not been fully understood. Now, under the Every Student Succeeds Act, many states are reporting chronic absenteeism data annually. This data story, updated with the <a href="https://www2.ed.gov/about/offices/list/ocr/docs/crdc-2015-16.html" target="_blank">2015–16 Civil Rights Data Collection (CRDC)</a>, bolsters efforts to reduce and ultimately eliminate chronic absenteeism so that all students have a better chance of reaching their full potential. The data from the CRCD is drawn from nearly every public school in the country and helps us understand who is chronically absent, at what grade levels chronic absenteeism tends to occur, and how chronic absenteeism compares community-by-community and state-by-state.
                </p>
                <div class="disclaimer">
                    <div style="display: table-row; width: 100%;">
                        <div style="display: table-cell; vertical-align: middle; width: 10%;">
                            <div class="icon"><span class="left icon fa-bar-chart-o"></span></div>
                        </div>
                        <div class="right">
                            Note: Data included in this story may differ slightly from other published reports due to certain data decisions. This data story has been updated to incorporate the 2015–16 Civil Rights Data Collection (CRDC).
                        </div>
                    </div>
                </div>
                <div class="disclaimer">
                    <div style="display: table-row; width: 100%;">
                        <div style="display: table-cell; vertical-align: middle; width: 10%;">
                            <div class="icon"><span class="left icon fa-mouse-pointer"></span></div>
                        </div>
                        <div class="right">
                            Our charts are interactive! Hover over or click on chart elements to learn more about specific data points and, where they appear, use buttons to filter charts by select groups.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- One -->
        <section id="one" class="wrapper image1">
            <div class="inner">
                <div class="row">
                    <div class="6u 12u$(medium)">
                        <!-- FYI: no alt text necessary on chair because extraneous image, meaning-wise -->
                        <img src="images/chairMask.svg" class="chair" alt="">
                    </div>
                    <div id="counter" class="6u$ 12u$(medium)">
                        <h2>
                            OVER 7 MILLION
                            <span style="line-height: 1.75em;">
                                students missed 15 or more days of school in 2015-16.
                            </span>
                        </h2>
                        <p style="margin-top:1.5em; line-height: 1.75em;">
                            That's 16 percent of the student population—<b>or about 1 in 6 students.</b>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="one_chart" class="wrapper chart">
            <div id="one_sections" class="inner">
                <div class="align-center">
                    <img class="barChart-icon" src="images/barIcon_chartArea.svg" alt="Bar Chart Icon" />
                </div>
                <div class="chart"></div>
                <p style="margin-top:1.5em; margin-bottom:3.5em;">
                  Let’s take a closer look at which groups of students were more likely to be chronically absent. Disparities in chronic absenteeism by key demographic characteristics are evident, though unacceptable levels of chronic absenteeism exist for all students.
                </p>
                <div id="ch1_2"></div>
                <p style="margin-top:1.5em;">
                  The disparities are striking. Consider the relative differences: compared to their white peers, American Indian and Pacific Islander students are over 50 percent more likely to lose three weeks of school or more, black students 40 percent more likely, and Hispanic students 17 percent more likely.
                </p>
                <p style="margin-bottom: 3.5em;">
                  See chronic absenteeism rates for other student groups in the next chart.
                </p>
                <p class="align-center" style="margin-top:3.5em;">
                  View Chart By:
                </p>
                <div id="ch1_3"></div>
                <p style="margin-top:1.5em;">
                  One notable trend: English learners, who face significant barriers in school and society, are approximately 1.2 times less likely to be chronically absent than their non-English learner peers. Fourteen percent of English learners are chronically absent compared to 16 percent of non-English learners.
                </p>
                <p>
                  The same is not true for students with disabilities who are 1.5 times more likely to be chronically absent than students without disabilities. The Individuals with Disabilities Education Act (IDEA) is intended to ensure all students with disabilities have access to a free, appropriate education yet chronic absenteeism is a barrier that gets in the way of achieving that goal.
                </p>
                <p>
                  At roughly 16 percent each, male and female students are similarly likely to be chronically absent.
                </p>
            </div>
        </section>

        <!-- Two -->
        <section id="two" class="wrapper style1">
            <div class="inner">
                <h2 class="line">Lost Along the Way</h2>
                <p>
                  Chronic absenteeism occurs at every grade level but is more prevalent in some grades than others. Chronic absenteeism rates are highest in high school, according to data in the 2015-16 Civil Rights Data Collection. Other research suggests that students in the early elementary grades <a href="http://www.attendanceworks.org/wordpress/wp-content/uploads/2014/06/A-National-Portrait-of-Chronic-Absenteeism-in-the-Early-Grades-Oct-2007.pdf" target="_blank">also experience high rates of chronic absenteeism</a>, which may be masked in analyses that are only available at the school level (as is the case here). Understanding when students are most at risk will help schools and advocates better target interventions to improve student outcomes.
                </p>
            </div>
        </section>

        <section id="two_chart" class="wrapper chart">
            <div id="two_sections" class="inner">
                <div class="align-center">
                    <img class="barChart-icon" src="images/barIcon_chartArea.svg" alt="Bar Chart Icon" />
                </div>
                <div style="margin-bottom: 1.5em" class="chart"></div>
                <div id="ch2_1">
                </div>
                <p style="margin-top: 1.5em;">
                    Overall, more than 20 percent of students in high school are chronically absent compared to more than 14 percent of students in middle school. The chronic absenteeism rate was the lowest for elementary school students, at 13 percent. For more information on how we defined grade levels, <a href="#datanotes">see the data notes</a>.
                </p>
                <p style="margin-bottom: 3.5em;">
                    Next, we looked at how chronic absenteeism varied across grade levels for specific groups of students.
                </p>
                <p class="align-center" style="margin-top:3.5em;">
                  View Chart By:
                </p>
                <div id="ch2_2"></div>
                <p style="margin-top:1.5em;">
                    For each subgroup of students there is a similar pattern: the likelihood of chronic absenteeism increases as students progress into high school. Notably, the stronger overall attendance observed among English learners dissipates over grade levels, such that they experience higher chronic absenteeism than their non-English learner peers when they reach high school.
                </p>
            </div>
        </section>

        <!-- Three -->
        <section id="three" class="wrapper style3">
            <div class="inner">
                <h2 class="line">The Geography of Chronic Absenteeism</h2>
                <p>
                    Students experience chronic absenteeism from coast to coast. Disturbingly, approximately 750 school districts reported that more than 30 percent of their students missed at least three weeks of school in 2015-16.
                </p>
                <div class="disclaimer">
                    <div style="display: table-row; width: 100%;">
                        <div style="display: table-cell; vertical-align: middle; width: 10%;">
                            <div class="icon"><span class="legendPointer icon fa-mouse-pointer"></span></div>
                        </div>
                        <div class="legendExplain">
                            Hover over school districts for information, double-click to zoom in, and select a range from the legend to see specific views of the data. Select the buttons below the map to toggle between percentages for elementary and unified school districts, and independent elementary, secondary, and unified districts.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Map -->
        <section class="wrapper chart">
            <div class="inner" style="padding-bottom: 0em;">

                <!-- Spinner loader (see loader.css) -->
                <div class="loader">Loading...</div>

                <div id="mapWrapper">

                    <!-- MAP #1 (left toggle) -->
                    <div id="percentLegend" class="legend" style="display: none;">
                        <h3 class="title">% of students who were chronically absent in <span class="nowrap">(2015–16)</span></h3>
                        <div class="legendContainer">

                            <div class="legendButtonWrapper">
                                <div data-value="#bbc7df" class="legendButton">
                                    <div style="background-color: #bbc7df;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        0%
                                    </div>
                                </div>
                                <div data-value="#9c9ac9" class="legendButton">
                                    <div style="background-color: #9c9ac9;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        &gt;0% to 5%
                                    </div>
                                </div>
                                <div data-value="#7f7dbc" class="legendButton">
                                    <div style="background-color: #7f7dbc;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        &gt;5% to 15%
                                    </div>
                                </div>
                                <div data-value="#6954a1" class="legendButton">
                                    <div style="background-color: #6954a1;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        &gt;15% to 30%
                                    </div>
                                </div>
                                <div data-value="#491c85" class="legendButton">
                                    <div style="background-color: #491c85;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        &gt;30%
                                    </div>
                                </div>
                                <div style="clear: both;"></div>
                            </div>


                        </div>

						   <div class="innerLegend">
                                <div data-value="gray" class="legendButton null" style="float: none; margin: auto;">
                                    <div style="background-color: gray;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        No data*
                                    </div>
                                </div>
                                <div style="clear: both;"></div>
                            </div>

                        <!-- end legendContainer -->
                    </div>
                    <!-- end legend 1 -->

                    <div id="map">
                        <div class="mapControlsParent">
                            <div class="mapControlsContainer">
                                <div class="mapZoomContainer">
                                    <!--<div style="clear: both; height:5px"></div>-->
                                    <button class="zoomButton" data-zoom="+1">+</button>
                                    <div style="clear: both; height:5px"></div>
                                    <button class="zoomButton" data-zoom="-1">-</button>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- end map -->

					<!-- Map sub-filters togle buttons (mapSubFiltersContainer) -->
					<div class="mapControlsContainer">
						<div id="selectDistrictType">
							<div id="selectElementary" class="mapButton selectedMapButton">Elementary and Unified</div>
							<div id="selectSecondary" class="mapButton deselectedMapButton">Independent Elementary, Secondary, and Unified</div>
						</div>
					</div>

                </div>
                <!-- end mapWrapper -->

                <div>
                  <p class="dataLinksText" style="margin-bottom: 0em;">* <a href="#mapnotes">See map notes</a>. <!--<a href="#">Download the district level data</a> used in this map.--></p>
                </div>

            </div>
            <!-- end innner -->
        </section>

        <!-- Four -->
        <section id="four" class="wrapper style1">
            <div class="inner">
                <h2 class="line">Why Chronic Absenteeism Matters: What the Research Says</h2>
                <p>
                    Chronic absenteeism is widespread—about one out of every six students missed three weeks or more of school in 2015-16. That translates to more than 100 million school days lost Research suggests the reasons for chronic absenteeism are as varied as the challenges our students and families face—including <a href="http://new.every1graduates.org/wp-content/uploads/2012/05/FINALChronicAbsenteeismReport_May16.pdf" target="_blank">poor health, limited transportation, and a lack of safety</a> — which can be particularly acute in disadvantaged communities and <a href="http://www.attendancecounts.org/wordpress/wp-content/uploads/2010/04/Ready-2010-2.pdf" target="_blank">areas of poverty</a>.
                </p>
                <p style="margin-bottom: 3.5em;">
                  Whatever its causes, chronic absenteeism can be devastating:
                </p>
                <ul class="callout">
                    <li>
                        <h3 class="icon style1 fa-book">Chronic absenteeism may prevent children from reaching early learning milestones.</h3>
                        <p>
                          Children who are chronically absent in preschool, kindergarten, and first grade are <a href="https://ccsr.uchicago.edu/publications/preschool-attendance-chicago-public-schools-relationships-learning-outcomes-and-reasons" target="_blank">much less likely to read at grade level by the third grade</a>. Students who cannot read at grade level by the end of third grade are <a href="http://www.aecf.org/m/resourcedoc/AECF-DoubleJeopardy-2012-Full.pdf" target="_blank">four times more likely than proficient readers to drop out of high school</a>.
                        </p>
                    </li>
                    <li>
                        <h3 class="icon style2 fa-graduation-cap">Irregular attendance can be a better predictor of whether students will drop out before graduation than test scores.</h3>
                        <p>
                          <a href="https://www.schools.utah.gov/file/31291767-087c-4edb-8042-87f272507c1d" target="_blank">A study of public school students in Utah</a> found that an incidence of chronic absenteeism in even a single year between 8th and 12th grade was associated with a seven-fold increase in the likelihood of dropping out.
                        </p>
                    </li>
                </ul>
            </div>
        </section>

        <section class="wrapper style3">
            <div class="inner">
                <div class="socialmedia">
                    <ul class="align-right icons">
                        <li><a href="#" target="_blank" title="Tweet" class="fa-twitter"><span class="label">Twitter</span></a></li>
                        <li><a href="#" target="_blank" title="Share on Facebook" class="fa-facebook"><span class="label">Facebook</span></a></li>
                        <li><a href="#" target="_blank" title="Share on LinkedIn" class="fa-linkedin"><span class="label">LinkedIn</span></a></li>
                        <li><a href="#" target="_blank" title="Email" class="fa-envelope"><span class="label">Email</span></a></li>
                    </ul>
                </div>
                <h2 class="line">The Path Forward: Every Student, Every Day</h2>
                <p>
                  The very students who tend to face significant challenges and need the most educational supports are often missing the most school.
                </p>
                <p>
                  When our teachers, principals, policymakers, and others have access to robust data on the extent and nature of chronic absenteeism, we are all in a better position to provide students with the supports they need to stem this crisis in our schools.
                </p>
                <p>
                  The 2015 federal education law the Every Student Succeeds Act (ESSA) empowered states to create unique statewide accountability systems. In addition to measurements of annual school performance, ESSA requires states to hold schools accountable for one measure of “school quality or student success (SQSS)” (ESSA 2015, 111-31) and 36 states, the District of Columbia, and Puerto Rico submitted plans to the U.S. Department of Education to use chronic absenteeism as one SQSS indicator.
                </p>
                <p style="margin-bottom: 3.5em;">
                  Through an array of resources, the Department of Education is committed to helping ensure all our students, especially the most disadvantaged, are in school every day, including:
                </p>
                <ul class="callout">
                    <li>
                        <h3 class="icon style1 fa-bus">
                          <a href="http://www2.ed.gov/about/inits/ed/chronicabsenteeism/index.html" target="_blank">Every Student, Every Day: A national initiative to address and eliminate chronic absenteeism.</a>
                        </h3>
                        <p>
                          Supports coordinated community action that addresses the underlying causes of local chronic absenteeism affecting millions of children in our nation's public schools each year.
                        </p>
                    </li>
                    <li>
                        <h3 class="icon style3 fa-table">
                          <a href="http://www2.ed.gov/about/offices/list/ocr/docs/crdc-2015-16.html" target="_blank">The Civil Rights Data Collection (CRDC): A biennial survey required by the Department’s Office for Civil Rights since 1968.</a>
                        </h3>
                        <p>
                          The CRDC shines a spotlight on data that enable us to understand the successes and challenges of schools and school districts in providing educational opportunity to all of our nation’s children.
                        </p>
                    </li>
                </ul>

            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer id="footer" class="wrapper style1-alt">
        <div class="inner align-center">
		        <h2 class="line" id="datanotes">Data Notes</h2>
            <div class="6u$ 12u$(medium) dataExclusion">
                <h3 class="line">Data Exclusion Rules</h3>
                <p>
                  Data included in this story may differ slightly from other published reports due to certain data decisions. For the purposes of these analyses, schools with incomplete or inconsistent data values were excluded. Less than 6% of schools were excluded for the following reasons:
                </p>
                <ol>
                    <li>The chronic absenteeism question was not applicable to the school (the school must have students enrolled in grades K–12).</li>
                    <li>The school reported incomplete data for enrollment and/or the chronic absenteeism count for at least one race/ethnicity subgroup.</li>
                    <li>The chronic absenteeism count was larger than the K–12 enrollment for at least one race/ethnicity subgroup. Schools with partial or missing data for students with disabilities or English learners were included in all analyses except those that focused on these subgroups.</li>
                </ol>
            </div>
            <div class="6u$ 12u$(medium) dataExclusion">
                <h3 style="font-size: 15px;" class="line">Grade Level Definitions</h3>
                <p>
                  School grade levels were defined using the National Center for Education Statistics (NCES) definition: elementary schools are those in which the lowest grade offered is PK through grade 3 and the highest is PK through grade 8, middle schools are those in which the lowest grade offered is grade 4 through grade 7 and the highest is grade 4 through grade 9, high schools are those in which the lowest grade offered is grade 7 through grade 12 and the highest is grade 12, other schools are those with any other configuration that does not fall within the previous three categories.
                </p>
            </div>
            <div class="6u$ 12u$(medium) dataExclusion">
                <h3 style="font-size: 15px;" class="line">Map Notes</h3>
                <p>Data might be missing from the chronic absenteeism map if:</p>
                <ol>
                    <li>A district did not report chronic absenteeism data or the data were inconsistent.</li>
                    <li>A district that reported chronic absenteeism data did not match with the NCES district boundary file.</li>
                    <li>District boundaries overlapped and we could not associate reported data with a unique district boundary.</li>
					          <li>Twenty-five percent of district enrollment was in schools with incomplete or inconsistent data (see Data Exclusion Rules).</li>
                </ol>
				        <p>
                  District data displayed on the map may not be based on all schools in the district. All districts with data have complete and consistent data for at least 75 percent of their enrollment.</p>
		  <p>The available district boundary information for some districts in Vermont reflects the boundaries of a supervisory union rather than a regular school district. As a result, the CRDC data for schools in 254 regular Vermont school districts were aggregated and mapped as part of one of 45 supervisory unions.
                </p>
            </div>
        		<!-- <div class="6u$ 12u$(medium) dataExclusion">
              <h3 style="font-size: 15px;" class="line">Document History</h3>
              <p>
                This data story was originally issued on June 7, 2016. On October 27, 2016, we updated the data story to incorporate corrected data submitted by the state of Florida on behalf of its school districts.
              </p>
            </div> -->
        </div>
    </footer>

    <!-- D3 charts -->
    <script src="assets/js/d3.v3.min.js"></script>
    <script src="assets/js/d3-tip.js"></script>
    <script src="assets/js/chart-functions.js"></script>
    <script src="assets/js/graph-scroll.js"></script>

    <script>

        // chapter 1 charts

        d3.tsv("assets/data/data.tsv", function (error, data) {
            if (error) { console.log(error); }
            else {
                data.forEach(function (d) {
                    d.var1 = d.group; // This is the subgroup
                    d.var2 = +d.number; // This is the raw number
                    d.var3 = +d.pct; // This is the percentage
                    d.subchart = +d.subchart;
                    d.var4 = d.level;
                });

                data1_2 = data.filter(function (d) { return d.chart == "1-2"; })
                data1_3 = data.filter(function (d) { if ((d.chart == "1-3") || (d.chart == "1-4") || (d.chart == "1-5")) { return d; } });

                // var chart1_1 = donutChart().data(data1_1).title("students were chronically absent in 2013-14"); // Chapter 1-1
                var chart1_2 = barChart().marginLeft(150).data(data1_2).containerID("one_chart").subcontainerID("one_sections").sectionID("ch1_2").chartID("chart1_2")
                  .xAxisLabel("% CHRONICALLY ABSENT IN 2015-16")
        					.title("While prevalent across the country, students of different races and ethnicities experience chronic absenteeism at different rates.")
        					.altText("This chart illustrates the percentage of students, by race or ethnicity, who were chronically absent in 2013-14.");
                  //.notes("<strong>Note: </strong>This is a test.")
                  //.source("<strong>Source: </strong>This is a test.");

                var chart1_3 = groupedCol().data(data1_3).containerID("one_chart").subcontainerID("one_sections").sectionID("ch1_3").chartID("chart1_3")
                  .yAxisLabel("% CHRONICALLY ABSENT IN 2015-16")
                  .title1("Chronic absenteeism is 15% less likely among English learners than non-English learners.")
                  .title2("Students with disabilities are about 50% more likely to be chronically absent than students without disabilities.")
                  .title3("Overall, chronic absenteeism does not differ significantly by gender.")
                  .altText1("This chart displays chronic absenteeism rates by English learner status.")
                  .altText2("This chart displays chronic absenteeism rates by disablity status.")
                  .altText3("This chart displays chronic absenteeism rates by gender.");
                  // .notes1("<strong>Note:</strong> Note 1.")
                  // .notes2("<strong>Note:</strong> Note 2.")
                  // .notes3("<strong>Note:</strong> Note 3.")
                  // .source1("<strong>Source:</strong> Source 1.")
                  // .source2("<strong>Source:</strong> Source 2.")
                  // .source3("<strong>Source:</strong> Source 3."); // Chapter 1 - 3

                d3.select("#ch1_2").call(chart1_2);
                d3.select("#ch1_3").call(chart1_3);

            };
        });

        // chapter 2-1

        d3.tsv("assets/data/data.tsv", function (error, data) {
            if (error) { console.log(error); }
            else {
                data.forEach(function (d) {
                    d.var1 = d.level;
                    d.var2 = +d.number;
                    d.var3 = +d.pct;
                });

                data = data.filter(function (d) { return d.chart == "2-1"; });

                var chart2_1 = dotPlot().data(data).containerID("two_chart").subcontainerID("two_sections").sectionID("ch2_1").chartID("chart2_1")
                  .xAxisLabel("% CHRONICALLY ABSENT IN 2015-16")
                  .title("Nearly 1 in 5 students in high school are chronically absent.")
                  .altText("This chart displays chronic absenteeism rates by school level.");
                  // .notes("<strong>Note:</strong> Test note.")
                  // .source("<strong>Source:</strong> Test source.");

                d3.select("#ch2_1").call(chart2_1);

            };
        });

        // chapter 2-2

        d3.tsv("assets/data/data.tsv", function (error, data) {
            if (error) { console.log(error); }
            else {
                data.forEach(function (d) {
                    d.number = +d.number;
                    d.pct = +d.pct;
                });

                data0 = data.filter(function (d) { return d.chart == "2-2"; });

                var chart2_2 = groupedBar().data(data0).marginLeft(150).animateTime(750).containerID("two_chart").subcontainerID("two_sections").sectionID("ch2_2").chartID("chart2_2")
                  .xAxisLabel("% CHRONICALLY ABSENT IN 2015-16")
                  .title1("Chronic absenteeism spikes in high school for students of every race and ethnicity.")
                  .title2("Females are slightly more likely to be chronically absent in high school than males.")
                  .title3("Students with disabilities face a greater risk of chronic absenteeism at every grade level.")
                  .title4("English learners are less likely to be chronically absent at every grade level except for high school.")
                  .altText1("This chart displays chronic absenteeism rates by race/ethnicity and school level.")
                  .altText2("This chart displays chronic absenteeism rates by gender and school level.")
                  .altText3("This chart displays chronic absenteeism rates by disability status and school level.")
                  .altText4("This chart displays chronic absenteeism rates by English learner status and school level.");
                  // .notes1("<strong>Note:</strong> Test note 1.")
                  // .notes2("<strong>Note:</strong> Test note 2.")
                  // .notes3("<strong>Note:</strong> Test note 3.")
                  // .notes4("<strong>Note:</strong> Test note 4.")
                  // .source1("<strong>Source:</strong> Test source 1.")
                  // .source2("<strong>Source:</strong> Test source 2.")
                  // .source3("<strong>Source:</strong> Test source 3.")
                  // .source4("<strong>Source:</strong> Test source 4.");

                d3.select("#ch2_2").call(chart2_2);

            };
        });

    </script>

    <!-- Map scripts -->
    <script>
        $(".legend").css("display", "none");

        //  D3 MAP
        var width = 960;
        var height = 500;
        var center = [width / 2, height / 2];
        var defaultFill = "#E6E6E6";
        var numberFormat = d3.format("0,000");

        var projection = d3.geo.albersUsa()
                .translate([width / 2, height / 2])
                .scale(1000);
        var zoom = d3.behavior.zoom()
                .scaleExtent([1, 32])
                .on("zoom", move);

        var path = d3.geo.path()
                .projection(projection);

        var svg = d3.select("#map").append("svg")
            .attr("preserveAspectRatio", "xMinYMin meet")
            .attr("viewBox", "0 0 " + width + " " + height)
            .classed("svg-content-responsive", true)
            .append("g");

        var g = svg.append("g");

        d3.select("#map > svg").call(zoom).call(zoom.event);

        var tooltip = d3.select("body").append("div")
            .attr("class", "districtTooltip")
            .style("opacity", 0)
            .style('top', '0px')
            .style('left', '0px');

        queue()
                .defer(d3.json, "assets/data/states.json")
                .defer(d3.json, "assets/data/elementary.json")
                .defer(d3.json, "assets/data/secondary.json")
                .defer(d3.json, "assets/data/extradistricts.json")
                .await(ready);

        svg.on("wheel.zoom", null);
        svg.on("mousewheel.zoom", null);

        function ready(error, us, primary, secondary, extra) {
            if (error) {
                console.log(error);
            }
            g.attr("cursor", "pointer");

            showLoader(function() {
                drawDistricts('elementary', primary, primary.objects.elementary);
                drawDistricts('extra', extra, extra.objects.extradistricts);
                drawStates(us, us.objects.states);
                $('.legend').show();
                resizeLegend();
            });


            //d3.select('#englishLearnersButton').on('click', function () {
            //    drawEnglishLearners();
            //});

            //d3.select('#percentChangeButton').on('click', function () {
            //    drawPercentChange();
            //});

            d3.select("#selectElementary").on("click", function () {
                d3.selectAll('.secondary').remove();
                $("#selectSecondary").removeClass('selectedMapButton').addClass('deselectedMapButton');
                $(this).removeClass('deselectedMapButton').addClass('selectedMapButton');
            });

            var legendButtons = $('.legendButton');

            d3.select("#selectSecondary").on("click", function () {
                drawDistricts('secondary', secondary, secondary.objects.secondary);
                var highlightedLegendButton = legendButtons.filter('.highlightButton');
                if(highlightedLegendButton.length > 0) {
                    var buttonValue = highlightedLegendButton.attr("data-value");
                    var colorFunc = getColorFunc();
                    svg.selectAll(".secondary")
                        .attr("fill", function (d) {
                            if (buttonValue === colorFunc(d)) {
                                return buttonValue;
                            }
                            else {
                                return "#E6E6E6";
                            }
                        });
                }
                $("#selectElementary").removeClass('selectedMapButton').addClass('deselectedMapButton');
                $(this).removeClass('deselectedMapButton').addClass('selectedMapButton');
            });

            legendButtons.on("click", function () {
                var colorFunc = getColorFunc();
                if ($(this).hasClass("highlightButton")) {
                    legendButtons.each(function () {
                        $(this).css("border", 0);
                        $(this).removeClass("highlightButton");
                    });
                    svg.selectAll('.district').attr('fill', colorFunc);
                }
                else {
                    legendButtons.each(function () {
                        $(this).css("border", 0);
                        $(this).removeClass("highlightButton");
                    });
                    $(this).addClass("highlightButton");
                    var buttonValue = $(this).attr("data-value");
                    svg.selectAll(".district")
                        .attr("fill", function (d) {
                            if (buttonValue === colorFunc(d)) {
                                return buttonValue;
                            }
                            else {
                                return "#E6E6E6";
                            }
                        });
                }
            });
        }

        function drawDistricts(id, topology, object) {
            var colorFunc = getColorFunc();
            g.append("g")
                .selectAll("path")
                .data(topojson.feature(topology, object).features)
                .enter().append("path")
                .attr("class", function(d) {
                    return id + " district";
                })
                .attr("d", path)
                .attr("stroke", "#fff")
                .attr("stroke-opacity", .15)
                .attr("stroke-linejoin", "round")
                .attr("fill", colorFunc)
                .on("mouseover", function (d) {
                    createTooltip(this, d);
                })
                .on("mouseout", function () {
                    d3.select(this).attr("stroke", "#fff")
                        .attr("stroke-opacity", .15);
                    d3.select(this).classed("selected", false);
                    tooltip.transition().duration(300).style("opacity", 0);
                });
        }

        function drawStates(topology, object) {
            g.append("g")
                .attr("class", "states")
                .selectAll("path")
                .data(topojson.feature(topology, object).features)
                .enter().append("path")
                .attr("class", "state")
                .attr("d", path);
        }


        function showLoader(fn) {
            $('.loader').show();
            setTimeout(function () {
                fn();
                $('.loader').hide();
            }, 100);
        }

        function drawBase() {
            $('#baseButton').removeClass('deselectedMapButton').addClass('selectedMapButton');
            //$('#percentChangeButton').removeClass('selectedMapButton').addClass('deselectedMapButton');
            $('.legend').hide();
            showLoader(function () {
                svg.selectAll('.district').attr('fill', colorByGroup);
                $('.legend').show();
                resizeLegend();
            });
        }

        //function drawPercentChange() {
        //    $('#baseButton').removeClass('selectedMapButton').addClass('deselectedMapButton');
        //    $('#percentChangeButton').removeClass('deselectedMapButton').addClass('selectedMapButton');
        //    $('.legend').hide();
        //    showLoader(function () {
        //        svg.selectAll('.district').attr('fill', colorByPercentChange);
        //        $('.legend').show();
        //        resizeLegend();
        //    });
        //}

        function getMapMode() {
            //if (d3.select('#baseButton').classed('selectedMapButton')) {
                return 'percent';
            //}
            //else {
            //    return 'percentChange';
            //}
        }

        function getColorFunc() {
            if (getMapMode() === 'percent') {
                return colorByGroup;
            }
            else {
                return colorByPercentChange;
            }
        }

        function createTooltip(currentDistrict, d) {
            d3.select(currentDistrict).attr("stroke", "#1A1C20")
                    .attr("stroke-opacity", 1);
            d3.select(currentDistrict).classed("selected", true);

            tooltip.transition().duration(100)
                    .style("opacity", 1)
                    .style("top", (d3.event.pageY - 100) + "px");

            var windowWidth = $(window).width();
            if (windowWidth > 1024) {
                if (d3.event.pageX > 1000) {
                    tooltip.style("left", (d3.event.pageX - 320) + "px");
                } else {
                    tooltip.style("left", (d3.event.pageX + 80) + "px");
                }
            }
            if (windowWidth < 1024 && windowWidth > 850) {
                if (d3.event.pageX > 400) {
                    tooltip.style("left", (d3.event.pageX - 320) + "px");
                } else {
                    tooltip.style("left", (d3.event.pageX + 80) + "px");
                }
            }
            if (windowWidth < 850) {
                if (d3.event.pageX > 350) {
                    tooltip.style("left", (d3.event.pageX - 320) + "px");
                } else {
                    tooltip.style("left", (d3.event.pageX + 40) + "px");
                }
            }
            if (windowWidth < 680) {
                if (d3.event.pageX > 350) {
                    tooltip.style("left", (d3.event.pageX - 320) + "px");
                } else {
                    tooltip.style("left", (d3.event.pageX + 20) + "px");
                }
            }

            var state = d.properties['State'];
            if (state === null) state = 'NO DATA';
            var name = d.properties['District'];
            if (name === null) name = "NO DATA";

            if (getMapMode() === 'percent') {
                var category = d.properties['Category'];
                if (category === 100) {
                    tooltip.html(
                        "<h3>" + state.toUpperCase() + "</h3>" +
                        "<hr>" +
                        "<h3>No Operating District</h3>"
                    );
                }
                else {
                    var numberChron = d.properties['Number chronically absent'];
                    numberChron = formatNumber(numberChron);
                    var totalNumberOfStudents = d.properties['Total number of students'];
                    totalNumberOfStudents = formatNumber(totalNumberOfStudents);
                    var percent = d.properties['Percent chronically absent'];
                    percent = formatPercent(percent);

                    tooltip.html(
                        "<h3>" + state.toUpperCase() + "</h3><hr>" +
                        "<h4>" + name + "</h4><hr>" +
                        "<div>Number chronically absent: " + numberChron + "</div>" +
                        "<div>Total number of students: " + totalNumberOfStudents + "</div>" +
                        "<div>% of students who are chronically absent: " + percent + "</div>"
                    );
                }
            }
            else {
                var category = d.properties['Change as % of 2009-10, categorized'];

                if(category === 100) {
                    tooltip.html(
                        "<h3>" + state.toUpperCase() + "</h3>" +
                        "<hr>" +
                        "<h3>No Operating District</h3>"
                    );
                }
                else {
                    var liep09 = d.properties['LIEP09'];
                    liep09 = formatNumber(liep09);
                    var liep14 = d.properties['LIEP14'];
                    liep14 = formatNumber(liep14);
                    var change = d.properties['Change from 2009-10 to 2014-15'];
                    var changePercent = d.properties['Change as % of 2009-10'];

                    if (category === 101) {
                        if(change === null) change = 'NO DATA';
                        else change = formatNumber(change);

                        if (changePercent === null) changePercent = 'NO DATA';
                        else changePercent = changePercent + '%';
                    }
                    else if (category === 0) {
                        if(change === null) change = 'Few or no ELs';
                        else change = formatNumber(change);

                        if (changePercent === null) changePercent = 'Few or no ELs';
                        else changePercent = changePercent + '%';
                    }
                    else {
                        change = formatNumber(change);

                        if (category === 1) {
                            changePercent = changePercent + '%';
                        }
                        else {
                            changePercent = formatPercent(changePercent);
                        }
                    }

                    tooltip.html(
                        "<h3>" + state.toUpperCase() + "</h3><hr>" +
                        "<h4>" + name + "</h4><hr>" +
                        "<div>Number of ELs in LIEP, 2009–10: " + liep09 + "</div>" +
                        "<div>Number of ELs in LIEP, 2014–15: " + liep14 + "</div>" +
                        "<div>Change from 2009–10 to 2014–15: " + change + "</div>" +
                        "<div>Change as % of 2009–10: " + changePercent + "</div>"
                    );
                }
            }
        }

        function formatNumber(n) {
            if (n === null) {
                return 'NO DATA';
            }
            else {
                return numberFormat(n);
            }
        }

        function formatPercent(p) {
            if (p === null) {
                return 'NO DATA';
            }
            if (p === '*') {
                return '<0.1%';
            }
            return p;

            /* Further processing not needed
            var rounded = Math.round(p * 10) / 10;
            // JS rounds negative values that have the exact decimal of .5 up instead of down,
            // i.e. -1.35 rounds to -1.3 instead of -1.4
            if(p < 0) {
                rounded = Math.round(Math.abs(p) * 10) / 10 * -1;
            }

            if(rounded === 0 && p < .1 && p > 0) {
                return '<0.1%';
            }
            else if(rounded === 0 && p > -.1 && p < 0) {
                return '>-0.1%';
            }
            else {
                return rounded + '%';
            }
            */
        }

        function resizeLegend() {
            var legend;
            $('.legend').hide();
            if (getMapMode() === 'percent') {
                legend = $('#percentLegend');
            }
            else {
                legend = $('#percentChangeLegend');
            }
            legend.show();
            var totalDistricts = svg.selectAll('.district').size();
            var nullDistricts = svg.selectAll('[fill="gray"]').size();
            var noELDistricts = svg.selectAll('[fill="#404040"]').size();
            totalDistricts -= nullDistricts + noELDistricts;
            var legendButtons = legend.find('.legendButton');
            legendButtons.each(function () {
                var buttonValue = $(this).attr("data-value");
                var valueSize = svg.selectAll('[fill="' + buttonValue + '"]').size();
                var width = (valueSize / totalDistricts) * 100;
                if (getMapMode() === 'percent' && $(this).hasClass("null")) {
                    width = width * 6;
                }
                else if (getMapMode() === 'percentChange' && $(this).hasClass("null")) {
                    width = valueSize / (nullDistricts + noELDistricts) * 100;
                }
                $(this).css("width", (width) + '%');
            });
        }

        function colorByGroup(d) {
            switch (d.properties['Category']) {
                case '1': return '#bbc7df';
                case '2': return '#9c9ac9';
                case '3': return '#7f7dbc';
                case '4': return '#6954a1';
                case '5': return '#491c85';
                default: return 'gray';
            }
        }

        function colorByPercentChange(d) {
            var percentChange = d.properties['Change as % of 2009-10, categorized'];

            switch (percentChange) {
                case -4: return '#08519c';
                case -3: return '#6baed6';
                case -2: return '#c6dbef';
                case 0: return '#404040';
                case 1: return '#9e9ac8';
                case 2: return '#756bb1';
                case 3: return '#54278f';
                case 4: return '#340d67';
            }
            return 'gray';
        }

        function interpolateZoom(translate, scale) {
            var self = this;
            return d3.transition().duration(350).tween("zoom", function () {
                var iTranslate = d3.interpolate(zoom.translate(), translate),
                        iScale = d3.interpolate(zoom.scale(), scale);
                return function (t) {
                    zoom
                            .scale(iScale(t))
                            .translate(iTranslate(t));
                    move();
                };
            });
        }

        function zoomClick() {
            var clicked = d3.event.target,
                    direction = 1,
                    factor = 0.2,
                    target_zoom = 1,
                    center = [width / 2, height / 2],
                    extent = zoom.scaleExtent(),
                    translate = zoom.translate(),
                    translate0 = [],
                    l = [],
                    view = { x: translate[0], y: translate[1], k: zoom.scale() };
            d3.event.preventDefault();
            direction = this.getAttribute("data-zoom");
            target_zoom = zoom.scale() * (1 + factor * direction);

            if (target_zoom < extent[0] || target_zoom > extent[1]) {
                return false;
            }

            translate0 = [(center[0] - view.x) / view.k, (center[1] - view.y) / view.k];
            view.k = target_zoom;
            l = [translate0[0] * view.k + view.x, translate0[1] * view.k + view.y];

            view.x += center[0] - l[0];
            view.y += center[1] - l[1];

            interpolateZoom([view.x, view.y], view.k);
        }

        function move() {
            d3.selectAll(".state").attr("stroke-width", resizeStateBorder());
            g.style("stroke-width", 1 / zoom.scale())
                    .attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
        }

        function resizeStateBorder() {
            var z = zoom.scale();
            return (z > 7) ? .25 :
                    (z > 4) ? .5 :
                            1
        }

        d3.selectAll(".zoomButton[data-zoom]").on("click", zoomClick);
        d3.select(self.frameElement).style("height", height + "px");

    </script>

</body>
</html>
