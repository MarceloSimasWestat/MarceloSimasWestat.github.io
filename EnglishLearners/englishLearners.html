<!DOCTYPE html>
<!--
    Hyperspace by Pixelarity
    pixelarity.com @pixelarity
    License: pixelarity.com/license
-->
<html lang="en-us">
<head>
    <title>English Learners - DRAFT</title>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/css/main.css" />
    <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->

    <!--<link rel="stylesheet" href="widgets.css" />-->
    <!-- <link rel="stylesheet" href="assets/css/chart-styles.css" /> -->
    <link rel="stylesheet" href="assets/css/loader.css" />

    <!-- browser tab icon (aka favicon) -->
    <link rel="icon" href="images/doelogo_rev.png" />

    <!-- Scripts -->
    <!--<script src="widgets.js"></script>-->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
    <script src="assets/js/main.js"></script>

    <!-- Substitutes high-res images for Retina displays (html file only) -->
    <script type="text/javascript" src="assets/js/retina.js"></script>

    <script src="assets/js/d3.v3.min.js"></script>
    <script src="assets/js/d3-tip.js"></script>
    <script src="assets/js/chart-functions.js"></script>
    <script src="assets/js/graph-scroll.js"></script>
    <script src="assets/js/queue.v1.min.js"></script>
    <script src="assets/js/topojson.v1.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <script src="https://unpkg.com/topojson-simplify@3"></script>

</head>
<body>

<div id="loader-wrapper">
    <div id="loader"></div>
    <div class="loader-section"></div>
</div>

<!-- Sidebar -->
<section id="sidebar">
    <div class="inner">

        <div class="nav-image">
            <img src="images/edsealbw.svg" alt="U.S. Department of Education" />
        </div>

        <div class="nav-wrapper">
            <nav>
                <ul style="margin-bottom: 1.5em;">
                    <li><a href="#mapWrapper">Concentration of EL Students Mapped - DRAFT</a></li>
                </ul>
            </nav>
            <ul class="icons socialmedia" style="margin-bottom: 0;">
                <li><a href="https://twitter.com/home?status=DYK?%20%2B2.5M%20students%20were%20out-of-school%20suspended%20in%202013-14.%20Among%20those,%0A25%25%20were%20black%20males.%20http%3A//www2.ed.gov/datastory/discipline/index.html" target="_blank" title="Tweet" class="fa-twitter"><span class="label">Twitter</span></a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//www2.ed.gov/datastory/discipline/index.html" target="_blank" title="Share on Facebook" class="fa-facebook"><span class="label">Facebook</span></a></li>
                <li><a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A//www2.ed.gov/datastory/discipline/index.html&title=Rethink%20Discipline.%20Who%20is%20losing%20critical%20learning%20time%20because%20of%20out-of-school%20suspension?&summary=&source=" target="_blank" title="Share on LinkedIn" class="fa-linkedin"><span class="label">LinkedIn</span></a></li>
                <li><a href="mailto:?&subject=Rethink Discipline: The Impact of Out of School Suspensions&body=%20http%3A%2F%2Fwww2.ed.gov%2Fdatastory%2Fdiscipline%2Findex.html" target="_blank" title="Email" class="fa-envelope"><span class="label">Email</span></a></li>
            </ul>
        </div>

        <!-- Given Flex, this allows the social media icons to be paired with the navigation links without hugging the bottom -->
        <div>
            &nbsp;
        </div>
    </div>
</section>

<!-- Wrapper -->
<div id="wrapper">

    <!-- EL Map -->
    <section class="wrapper chart">
        <div class="inner">

            <div>
                <div class="align-center">
                    <div id="mapButtonWrapper">
                        <button id="englishLearnersButton" class="mapHeaderButton selectedMapButton">English learners (2014-15)</button>
                        <button id="percentChangeButton" class="mapHeaderButton deselectedMapButton">Percent change (2009-10 to 2014-15)</button>
                    </div>

                    <div class="loader">Loading...</div>

                    <div id="mapWrapper">
                        <div id="percentLegend" class="legend" style="display: none;">
                            <h3>Percentage of students who are English learners (2014-15) - DRAFT</h3>
                            <div class="legendButtonWrapper">
                                <div data-value="#9e9ac8" class="legendButton">
                                    <div style="background-color: #9e9ac8;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        No EL students
                                    </div>
                                </div>
                                <div data-value="#756bb1" class="legendButton">
                                    <div style="background-color: #756bb1;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        Low
                                        <br>
                                        (&gt;0% to &lt;3%)
                                    </div>
                                </div>
                                <div data-value="#54278f" class="legendButton">
                                    <div style="background-color: #54278f;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        Medium
                                        <br>
                                        (3% to &lt;5%)
                                    </div>
                                </div>
                                <div data-value="#340d67" class="legendButton">
                                    <div style="background-color: #340d67;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        High
                                        <br>
                                        (20% or more)
                                    </div>
                                </div>
                                <div style="clear: both;"></div>
                            </div>
                            <div class="innerLegend">
                                <div data-value="gray" class="legendButton null" style="float: none; margin: auto;">
                                    <div style="background-color: gray;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        NULL*
                                    </div>
                                </div>
                                <div style="clear: both;"></div>
                            </div>
                        </div>

                        <div id="percentChangeLegend" class="legend" style="display: none;">
                            <h3>Percentage change in the number of ELs enrolled in an English language instruction educational program, 2009-10 to 2014-15 - DRAFT</h3>
                            <div class="legendButtonWrapper">
                                <div data-value="#08519c" class="legendButton">
                                    <div style="background-color: #08519c;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (&gt; 50% decrease)
                                    </div>
                                </div>
                                <div data-value="#6baed6" class="legendButton">
                                    <div style="background-color: #6baed6;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (20-50% decrease)
                                    </div>
                                </div>
                                <div data-value="#c6dbef" class="legendButton">
                                    <div style="background-color: #c6dbef;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (&lt; 20% decrease)
                                    </div>
                                </div>
                                <div data-value="#9e9ac8" class="legendButton">
                                    <div style="background-color: #9e9ac8;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (No change)
                                    </div>
                                </div>
                                <div data-value="#756bb1" class="legendButton">
                                    <div style="background-color: #756bb1;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (&lt; 20%)
                                    </div>
                                </div>
                                <div data-value="#54278f" class="legendButton">
                                    <div style="background-color: #54278f;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (20-75%)
                                    </div>
                                </div>
                                <div data-value="#340d67" class="legendButton">
                                    <div style="background-color: #340d67;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (&gt;=75%)
                                    </div>
                                </div>
                                <div style="clear: both;"></div>
                            </div>
                            <div class="innerLegend">
                                <div data-value="#404040" class="legendButton null">
                                    <div style="background-color: #404040;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        (No ELs)
                                    </div>
                                </div>
                                <div data-value="gray" class="legendButton null">
                                    <div style="background-color: gray;" class="legendButtonColor">
                                        <hr class="verticalLine">
                                    </div>
                                    <div class="legendText">
                                        NULL*
                                    </div>
                                </div>
                                <div style="clear: both;"></div>
                            </div>
                        </div>

                        <div id="map">
                            <div>
                                <div style="clear: both; height:5px"></div>
                                <button class="zoomButton" data-zoom="+1">+</button>
                                <div style="clear: both; height:5px"></div>
                                <button class="zoomButton" data-zoom="-1">-</button>
                            </div>
                        </div>
                        <div id="selectDistrictType">
                            <div id="selectElementary" class="mapButton selectedMapButton">Elementary and Unified</div>
                            <div id="selectSecondary" class="mapButton deselectedMapButton">Independent Elementary, Secondary, and Unified</div>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <br/>
                <p class="dataLinksText">* <a href="#datanotes">See data notes</a>. <a href="#">Download the district level data</a> used in this map.</p>
            </div>
        </div>
    </section>
</div>

<!-- Map -->

<script>
    $("#legend").css("display", "none");
    //  D3 MAP
    var width = 960;
    var height = 600;
    var center = [width / 2, height / 2];
    var defaultFill = "#E6E6E6";
    var numberFormat = d3.format("0,000");

    var projection = d3.geo.albersUsa()
            .translate([width / 2, height / 2])
            .scale(1000);
    var zoom = d3.behavior.zoom()
            .scaleExtent([1, 32])
            .on("zoom", move);

    var canvas = d3.select('#map').append('canvas')
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "0 0 " + width + " " + height)
        .attr('width', width)
        .attr('height', height);
    var context = canvas.node().getContext('2d');

    var path = d3.geo.path()
        .projection(projection)
        .context(context);

    var tooltip = d3.select("body").append("div")
        .attr("class", "districtTooltip")
        .style("opacity", 0)
        .style('top', '0px')
        .style('left', '0px');

    queue()
        .defer(d3.json, "assets/data/states.json")
        .defer(d3.json, "assets/data/elementary.json")
        .defer(d3.json, "assets/data/secondary.json")
        .defer(d3.json, "assets/data/extradistricts.json")
        .await(ready);

    var us, primary, secondary, extra, primaryFeatures;

    function ready(error, _us, _primary, _secondary, _extra) {
        if (error) {
            console.log(error);
        }

        us = _us;
        primary = _primary;
        secondary = _secondary;
        extra = _extra;
        var preSimplifiedPrimary = topojson.presimplify(primary);
        var simplifiedPrimary = topojson.simplify(preSimplifiedPrimary, .1);
        primaryFeatures = topojson.feature(simplifiedPrimary, primary.objects.medium_G5420_G5400).features;

        canvas.attr("cursor","pointer");

        d3.select('#englishLearnersButton').on('click', function() {
            drawEnglishLearners(primary, extra, us);
        });

        d3.select('#percentChangeButton').on('click', function() {
            drawPercentChange(primary, extra, us);
        });

        d3.select("#selectElementary").on("click", function () {
            $("#selectSecondary").removeClass('selectedMapButton').addClass('deselectedMapButton');
            $(this).removeClass('deselectedMapButton').addClass('selectedMapButton');
            $('.secondary').remove();
        });

        d3.select("#selectSecondary").on("click", function () {
            $("#selectElementary").removeClass('selectedMapButton').addClass('deselectedMapButton');
            $(this).removeClass('deselectedMapButton').addClass('selectedMapButton');
            $('.state').remove();
            drawDistricts('secondary', secondary, secondary.objects.medium_G5410, getColorFunc());
            drawStates(us, us.objects.states);
        });

        drawEnglishLearners(primary, extra, us);

        var legendButtons = $('.legendButton');
        legendButtons.on("click", function () {
            var colorFunc = getColorFunc();
            if ($(this).hasClass("highlightButton")) {
                legendButtons.each(function () {
                    $(this).css("border", 0);
                    $(this).removeClass("highlightButton");
                });
                svg.selectAll('.district').attr('fill', colorFunc);
            }
            else {
                legendButtons.each(function () {
                    $(this).css("border", 0);
                    $(this).removeClass("highlightButton");
                });
                $(this).addClass("highlightButton");
                var buttonValue = $(this).attr("data-value");
                svg.selectAll(".district")
                    .attr("fill", function (d) {
                        if (buttonValue === colorFunc(d)) {
                            return buttonValue;
                        } else {
                            return "#E6E6E6";
                        }
                    });
            }
        });

        canvas.call(zoom).call(zoom.event);
    }

    function showLoader(fn) {
        $('.loader').show();
        setTimeout(function() {
            fn();
            $('.loader').hide();
        }, 100);
    }

    function drawEnglishLearners(primary, extra, us) {
        $('#englishLearnersButton').removeClass('deselectedMapButton').addClass('selectedMapButton');
        $('#percentChangeButton').removeClass('selectedMapButton').addClass('deselectedMapButton');
        context.clearRect(0, 0, width, height);
        $('.legend').hide();
        showLoader(function() {
            drawDistricts('elementary', primary, primary.objects.medium_G5420_G5400, colorByGroup);
            drawDistricts('extra', extra, extra.objects.extra_districts, colorByGroup);
            drawStates(us, us.objects.states);
            $('.legend').show();
            resizeLegend();
        });
    }

    function drawPercentChange(primary, extra, us) {
        $('#englishLearnersButton').removeClass('selectedMapButton').addClass('deselectedMapButton');
        $('#percentChangeButton').removeClass('deselectedMapButton').addClass('selectedMapButton');
        context.clearRect(0, 0, width, height);
        $('.legend').hide();
        showLoader(function() {
            drawDistricts('elementary', primary, primary.objects.medium_G5420_G5400, colorByPercentChange);
            drawDistricts('extra', extra, extra.objects.extra_districts, colorByPercentChange);
            drawStates(us, us.objects.states);
            $('.legend').show();
            resizeLegend();
        });
    }

    function drawStates(topology, object) {
        /*g.append("g")
            .attr("class", "states")
            .selectAll("path")
            .data(topojson.feature(topology, object).features)
            .enter().append("path")
            .attr("class", "state")
            .attr("d", path);*/
        context.beginPath();
        path(topojson.mesh(topology));
        context.stroke();
    }

    function drawDistricts(id, topology, object, colorFunc) {
        /*g.append("g")
            .selectAll("path")
            .data(topojson.feature(topology, object).features)
            .enter().append("path")
            .attr("class", id + " district")
            .attr("d", path)
            .attr("stroke", "#fff")
            .attr("stroke-opacity", .15)
            .attr("stroke-linejoin", "round")
            .attr("fill", colorFunc)
            .on("mouseover", function (d) {
                createTooltip(this,d);
            })
            .on("mouseout", function () {
                d3.select(this).attr("stroke", "#fff")
                    .attr("stroke-opacity", .15);
                d3.select(this).classed("selected", false);
                tooltip.transition().duration(300).style("opacity", 0);
            });*/
        var start = new Date();
        for(var i = 0; i < primaryFeatures.length; i++) {
            var feature = primaryFeatures[i];
            context.fillStyle = colorFunc(feature);
            context.lineWidth = .2;
            context.strokeStyle = 'white';
            drawGeometry(feature.geometry);
        }
        console.log(new Date() - start);
    }

    function drawGeometry(geom) {
        if(geom.type === 'MultiPolygon') {
            for(var i = 0; i < geom.coordinates.length; i++) {
                var polyCoords = geom.coordinates[i];
                drawPolygon(polyCoords);
            }
        }
        else if(geom.type === 'Polygon') {
            drawPolygon(geom.coordinates);
        }
    }

    function drawPolygon(polyCoords) {
        for(var i = 0; i < polyCoords.length; i++) {
            var coords = polyCoords[i];
            drawPolyCoords(coords);
        }
    }

    function drawPolyCoords(coords) {
        context.beginPath();
        var firstCoord = coords[0];
        var projectedFirstCoord = projection(firstCoord);
        if(!projectedFirstCoord) return;
        context.moveTo(projectedFirstCoord[0], projectedFirstCoord[1]);
        for(var j = 1; j < coords.length; j++) {
            var coord = coords[j];
            var projected = projection(coord);
            context.lineTo(projected[0], projected[1]);
        }
        context.fill();
        context.stroke();
    }

    function getMapMode() {
        if(d3.select('#englishLearnersButton').classed('selectedMapButton')) {
            return 'percent';
        }
        else {
            return 'percentChange';
        }
    }

    function getColorFunc() {
        if(getMapMode() === 'percent') {
            return colorByGroup;
        }
        else {
            return colorByPercentChange;
        }
    }

    function createTooltip(currentDistrict,d){
        d3.select(currentDistrict).attr("stroke", "#1A1C20")
                .attr("stroke-opacity", 1);
        d3.select(currentDistrict).classed("selected", true);

        tooltip.transition().duration(100)
                .style("opacity", 1)
                .style("top", (d3.event.pageY - 100) + "px");

        var windowWidth = $(window).width();
        if (windowWidth > 1024) {
            if (d3.event.pageX > 1000) {
                tooltip.style("left", (d3.event.pageX - 320) + "px");
            } else {
                tooltip.style("left", (d3.event.pageX + 80) + "px");
            }
        }
        if (windowWidth < 1024 && windowWidth > 850) {
            if (d3.event.pageX > 400) {
                tooltip.style("left", (d3.event.pageX - 320) + "px");
            } else {
                tooltip.style("left", (d3.event.pageX + 80) + "px");
            }
        }
        if (windowWidth < 850) {
            if (d3.event.pageX > 350) {
                tooltip.style("left", (d3.event.pageX - 320) + "px");
            } else {
                tooltip.style("left", (d3.event.pageX + 40) + "px");
            }
        }
        if (windowWidth < 680) {
            if (d3.event.pageX > 350) {
                tooltip.style("left", (d3.event.pageX - 320) + "px");
            } else {
                tooltip.style("left", (d3.event.pageX + 20) + "px");
            }
        }

		var state = d.properties['State'];
		if(state === null) state = 'NO DATA';
		var name = d.properties['District'];
		if(name === null) name = "NO DATA";

        if (name === "School District Not Defined") {
            tooltip.html(
                "<h3>" + state.toUpperCase() + "</h3>" +
                "<hr>" +
                "<h3>No Operating District</h3>"
            );
        }
        else if (name != null) {
            if(getMapMode() === 'percent') {
                var percentEL = d.properties['Percent'];
                percentEL = formatPercent(percentEL);

                tooltip.html("<h3>" + state.toUpperCase() + "</h3><hr>" +
                    "<h4>" + name + "</h4><hr>" +
                    "<div> % of students who are English learners: " + percentEL + "</div>");
            }
            else {
                var liep09 = d.properties['LIEP09'];
                liep09 = formatNumber(liep09);
                var liep14 = d.properties['LIEP14'];
                liep14 = formatNumber(liep14);
                var change = d.properties['Change from 2009-10 to 2014-15'];
                change = formatNumber(change);
                var changePercent = d.properties['Change as % of 2014-15'];
                changePercent = formatPercent(changePercent);
                if(changePercent === 'NO DATA') {
                    change = 'NO DATA';
                }

                tooltip.html("<h3>" + state.toUpperCase() + "</h3><hr>" +
                    "<h4>" + name + "</h4><hr>" +
                    "<div>Number of ELs in LIEP, 2009-10: " + liep09 + "</div>" +
                    "<div>Number of ELs in LIEP, 2014-15: " + liep14 + "</div>" +
                    "<div>Change from 2009-10 to 2014-15: " + change + "</div>" +
                    "<div>Change as % of 2014-15: " + changePercent + "</div>"
                );
            }
        }
        else {
            tooltip.html("<h3>" + state.toUpperCase() + "</h3><hr>" +
                    "<h4>" + name + "</h4><hr>" +
                    "<div> NO DATA </div>");
        }
    }

    function formatPercent(p) {
        if (p === 0) {
            return 'N/A';
        }
        else if (p === null) {
            return 'NO DATA';
        }
        else if (p > 100) {
            return '>100%';
        }
        else {
            return p + '%';
        }
    }

    function formatNumber(n) {
        if (n === null) {
            return 'NO DATA';
        }
        else {
            return numberFormat(n);
        }
    }

    function resizeLegend() {
        var legend;
        $('.legend').hide();
        if(getMapMode() === 'percent') {
            legend = $('#percentLegend');
        }
        else {
            legend = $('#percentChangeLegend');
        }
        legend.show();
        var districts = $('.district');
        var totalDistricts = districts.length;
        var nullDistricts = districts.filter('[fill=gray]').length;
        var noELDistricts = districts.filter('[fill=#404040]').length;
        totalDistricts -= nullDistricts + noELDistricts;
        var legendButtons = legend.find('.legendButton');
        legendButtons.each(function () {
            var buttonValue = $(this).attr("data-value");
            var valueSize = districts.filter('[fill=' + buttonValue + ']').length;
            var width = (valueSize / totalDistricts) * 100;
            if (getMapMode() === 'percent' && $(this).hasClass("null")) {
                width = width * 6;
            }
            else if (getMapMode() === 'percentChange' && $(this).hasClass("null")) {
                width = valueSize / (nullDistricts + noELDistricts) * 100;
            }
            $(this).css("width", (width) + '%');
        });
    }

    function colorByGroup(d) {
        switch (d.properties['Category']){
            case -1: return 'gray';
            case 0: return '#9e9ac8';
            case 1: return '#756bb1';
            case 2: return '#54278f';
            case 3: return '#340d67';
            default: return 'gray';
        }
    }

    function colorByPercentChange(d) {
        var percentChange = d.properties['Change as % of 2014-15, categorized'];

        switch(percentChange) {
            case -4: return '#08519c';
            case -3: return '#6baed6';
            case -2: return '#c6dbef';
            case 0: return '#404040';
            case 1: return '#9e9ac8';
            case 2: return '#756bb1';
            case 3: return '#54278f';
            case 4: return '#340d67';
        }
        return 'gray';
    }

    /*function interpolateZoom(translate, scale) {
        var self = this;
        return d3.transition().duration(350).tween("zoom", function () {
            var iTranslate = d3.interpolate(zoom.translate(), translate),
                    iScale = d3.interpolate(zoom.scale(), scale);
            return function (t) {
                zoom
                    .scale(iScale(t))
                    .translate(iTranslate(t));
                move();
            };
        });
    }*/

    function zoomClick() {
        var clicked = d3.event.target,
                direction = 1,
                factor = 0.2,
                target_zoom = 1,
                center = [width / 2, height / 2],
                extent = zoom.scaleExtent(),
                translate = zoom.translate(),
                translate0 = [],
                l = [],
                view = {x: translate[0], y: translate[1], k: zoom.scale()};
        d3.event.preventDefault();
        direction = this.getAttribute("data-zoom");
        target_zoom = zoom.scale() * (1 + factor * direction);

        if (target_zoom < extent[0] || target_zoom > extent[1]) {
            return false;
        }

        translate0 = [(center[0] - view.x) / view.k, (center[1] - view.y) / view.k];
        view.k = target_zoom;
        l = [translate0[0] * view.k + view.x, translate0[1] * view.k + view.y];

        view.x += center[0] - l[0];
        view.y += center[1] - l[1];

        zoom.translate([view.x, view.y]);
        zoom.scale(view.k);
        move();

        //interpolateZoom([view.x, view.y], view.k);
    }

    function move() {
        /*d3.selectAll(".state").attr("stroke-width", resizeStateBorder());
        g.style("stroke-width", 1 / zoom.scale())
                .attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");*/
        var zoomTranslation = zoom.translate();
        projection
            .scale(1000 * zoom.scale())
            .translate([width / 2 + zoomTranslation[0], height / 2 + zoomTranslation[1]]);
        context.clearRect(0, 0, width, height);
        drawDistricts('elementary', primary, primary.objects.medium_G5420_G5400, colorByGroup);
        drawDistricts('extra', extra, extra.objects.extra_districts, colorByGroup);
        drawStates(us, us.objects.states);
    }

    function resizeStateBorder() {
        var z = zoom.scale();
        return (z > 7) ? .25 :
                (z > 4) ? .5 :
                        1
    }

    d3.selectAll(".zoomButton[data-zoom]").on("click", zoomClick);
    d3.select(self.frameElement).style("height", height + "px");

</script>
</body>
</html>
