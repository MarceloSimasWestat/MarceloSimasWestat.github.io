<!DOCTYPE html>
<!--
    Hyperspace by Pixelarity
    pixelarity.com @pixelarity
    License: pixelarity.com/license
-->
<html lang="en-us">
<head>
    <title>Chronic Absenteeism in the Nation's Schools</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/css/main.css" />
	    <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->

    <!--<link rel="stylesheet" href="widgets.css" />-->
    <!-- <link rel="stylesheet" href="assets/css/chart-styles.css" /> -->

    <!-- browser tab icon (aka favicon) -->
    <link rel="icon" href="images/doelogo_rev.png" />
    <!-- Scripts -->
    <!--<script src="widgets.js"></script>-->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
    <script src="assets/js/main.js"></script>

    <!-- Substitutes high-res images for Retina displays (html file only) -->
    <script type="text/javascript" src="assets/js/retina.js"></script>

    <script src="assets/js/d3.min.js"></script>
    <script src="assets/js/queue.v1.min.js"></script>
    <script src="assets/js/topojson.v1.min.js"></script>

</head>
<body>

    <div id="loader-wrapper">
        <div id="loader"></div>
        <div class="loader-section"></div>
    </div>

    <!-- Sidebar -->
    <section id="sidebar">
        <div class="inner">

            <div class="nav-image">
                <img src="images/edsealbw.svg" alt="Department of Learning" />
            </div>

            <div class="nav-wrapper">
                <nav>
                    <ul>
                        <li><a href="#intro">Introduction</a></li>
                        <li><a href="#one">Who is Impacted</a></li>
                        <li><a href="#two">Unstable Pathways</a></li>
                        <li><a href="#three">Chronic Absence Mapped</a></li>
                        <li><a href="#four">Why It Matters</a></li>
                    </ul>
                </nav>
                <ul class="icons socialmedia" style="margin-bottom: 0;">
                    <li><a href="https://twitter.com/home?status=Over%206%20million%20students%20miss%2015%20days%20or%20more%20per%20school%20year.%20This%20needs%20to%20change.%20http%3A//bit.ly/ChronicAbsenteeismInAmerica%20%40usedgov" target="_blank" title="Tweet" class="fa-twitter"><span class="label">Twitter</span></a></li>
                    <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//www2.ed.gov/datastory/chronicabsenteeism.html" target="_blank" title="Share on Facebook" class="fa-facebook"><span class="label">Facebook</span></a></li>
                    <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww2.ed.gov%2Fdatastory%2Fchronicabsenteeism.html&title=Chronic%20Absenteeism%20in%20the%20Nation's%20Schools&summary=&source=http%3A%2F%2Fwww2.ed.gov%2Fdatastory%2Fchronicabsenteeism.html" target="_blank" title="Share on LinkedIn" class="fa-linkedin"><span class="label">LinkedIn</span></a></li>
                    <li><a href="mailto:?subject=Chronic%20Absenteeism%20in%20the%20Nation's%20Schools&body=:%20http%3A%2F%2Fwww2.ed.gov%2Fdatastory%2Fchronicabsenteeism.html" target="_blank" title="Email" class="fa-envelope"><span class="label">Email</span></a></li>
                </ul>
            </div>

            <!-- Given Flex, this allows the social media icons to be paired with the navigation links without hugging the bottom -->
            <div>
                &nbsp;
            </div>
        </div>
    </section>

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Intro 1 -->
        <section id="intro" class="wrapper style1 fullscreen fade-up">
            <div class="inner">
                <h1 style="max-width: 650px;">CHRONIC ABSENTEEISM IN THE NATION'S SCHOOLS<br></h1>
                <p style="font-size:15pt">An unprecedented look at a hidden educational crisis.</p>
                <ul class="actions">
                    <li><span class="buttonInactive">— U.S. Department of Education</span></li>
                </ul>
            </div>
        </section>

        <!-- InformED Shouout -->

        <section class="wrapper style5">
            <div class="inner align-center" style="padding-top: 40px; padding-bottom: 20px;">
                <div>
                    <i class="fa fa-bolt fa-lg" style="margin-bottom: 1em; color: rgba(255,255,255,1);"></i>
                </div>
                <p>Powered by InformED and the <a href="http://www2.ed.gov/about/offices/list/ocr/docs/crdc-2013-14.html">2013-14 Civil Rights Data Collection.</a></p>
            </div>
        </section>

        <!-- Intro 2 -->
        <section class="wrapper style3">
            <div class="inner">

                <div class="align-right">
                    <div style="margin-bottom: 2.5em;">
                        <input type="checkbox" id="highContrast" name="highContrast">
                        <label for="highContrast">Enable High Contrast (508)</label>
                    </div>
                </div>

                <h2 class="line">New Data Illuminates the Extent of Chronic Absenteeism</h2>
                <p class="afterHeadesr">
                    Education can only fulfill its promise as the great equalizer—a force that can
                    overcome differences in privilege and background—when we work to ensure that
                    students are in school every day and receive
                    the supports they need to learn and thrive.
                </p>
                <p>
                    At the same time, we know that many students experience tremendous
                    adversity in their lives—including poverty, health challenges,
                    community violence, and difficult family circumstances—that make
                    it difficult for them to take advantage of the opportunity to learn at school.
                </p>
                <p style="margin-bottom:3.5em;">
                    Students who are chronically absent—meaning they miss at least
                    15 days of school in a year—are at serious risk of falling behind
                    in school. Yet, too few states report information about chronic absenteeism and,
                    for too long, this crisis in our nation’s public elementary and secondary schools has not
                    been fully understood. The release of the Department’s <a href="http://www2.ed.gov/about/offices/list/ocr/docs/crdc-2013-14.html">
                        2013-14 Civil Rights Data
                        Collection (CRDC)
                    </a> marks a turning point in the effort to reduce and ultimately eliminate chronic
                    absenteeism so that all students have a better chance of reaching their full potential.
                    The data from the CRCD is drawn from nearly every public school
                    in the country and helps us understand who is chronically
                    absent, at what grade levels chronic absenteeism tends to
                    occur, and how chronic absenteeism compares
                    community-by-community and state-by-state.
                </p>
                <div class="disclaimer">
                    <div style="display: table-row; width: 100%;">
                        <div style="display: table-cell; vertical-align: middle; width: 10%;">
                            <div class="icon"><span class="left icon fa-bar-chart-o"></span></div>
                        </div>
                        <div class="right">
                            Note: Data included in this story may differ slightly from other published reports due to certain data decisions.
                            <a href="#datanotes">More information</a>.
                        </div>
                    </div>
                </div>
                <p></p>
                <div class="disclaimer">
                    <div style="display: table-row; width: 100%;">
                        <div style="display: table-cell; vertical-align: middle; width: 10%;">
                            <div class="icon"><span class="left icon fa-mouse-pointer"></span></div>
                        </div>
                        <div class="right">
                            Our charts are interactive! Hover over or click on chart elements to learn more about specific data points
                            and, where they appear, use buttons to filter charts by select groups.
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- One -->
        <section id="one" class="wrapper image1">
            <div class="inner">
                <div class="row">
                    <div class="6u 12u$(medium)">
                        <!-- FYI: no alt text necessary on chair because extraneous image, meaning-wise -->
                        <img src="images/chairMask.svg" class="chair" alt=""> 
                    </div>
                    <div id="counter" class="6u$ 12u$(medium)">
                        <h2>
                            OVER 6 MILLION
                            <span style="line-height: 1.75em;">
                                students missed 15 or more days of school in 2013-14.
                            </span>
                        </h2>
                        <p style="margin-top:1.5em; line-height: 1.75em;">
                            That's 13 percent of the student population—<b>or 1 in 8 students.</b>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="one_chart" class="wrapper chart">
            <div id="one_sections" class="inner">
                <div class="align-center">
                    <img class="barChart-icon" src="images/barIcon_chartArea.svg" alt="Bar Chart Icon" />
                </div>
                <div class="chart"></div>

                <p style="margin-top:1.5em; margin-bottom:3.5em;">
                    Let’s take a closer look at which groups of students were more
                    likely to be chronically absent. Disparities in chronic absenteeism by key demographic
                    characteristics are evident, though unacceptable levels of chronic absenteeism exist for
                    all students.
                </p>

                <div></div>
                <div id="ch1_2">

                </div>

                <p style="margin-top:1.5em;">The disparities are striking. Consider the relative differences: compared to their white peers, American Indian and Pacific Islander students are over 50 percent more likely to lose three weeks of school or more, black students 30 percent more likely, and Hispanic students 9 percent more likely.</p>

                <p style="margin-bottom: 3.5em;">See chronic absenteeism rates for other student groups in the next chart.</p>

                <p class="align-center" style="margin-top:3.5em;">View Chart By:</p>
                <div id="ch1_3">
                    <p></p>
                </div>

                <div></div>


                <p style="margin-top:1.5em;">One notable trend: English learners, who face significant barriers in school and society, are 1.2 times less likely to be chronically absent than their non-English learner peers. Less than 11 percent of English learners are chronically absent compared to more than 13 percent of non-English learners.</p>

                <p>The same is not true for students with disabilities who are 1.3 times more likely to be chronically absent than students without disabilities. The Individuals with Disabilities Education Act (IDEA) is intended to ensure all students with disabilities have access to a free, appropriate education yet chronic absenteeism is a barrier that gets in the way of achieving that goal.</p>

                <p>At roughly 13 percent each, male and female students are similarly likely to be chronically absent.
            </div>
        </section>

        <!-- Two -->
        <section id="two" class="wrapper style1">
            <div class="inner">
                <h2 class="line">Lost Along the Way</h2>
                <p>
                    Chronic absenteeism occurs at every grade level but is more prevalent in some grades
                    than others. Chronic absenteeism rates are highest in high school, according to data
                    in the 2013-14 Civil Rights Data Collection. Other research suggests
                    that students in the early elementary grades <a href="http://www.attendanceworks.org/wordpress/wp-content/uploads/2014/06/A-National-Portrait-of-Chronic-Absenteeism-in-the-Early-Grades-Oct-2007.pdf">also experience high rates of chronic absenteeism</a>, which may be masked in analyses that are only available at the school level (as is the case here).
                    Understanding when students are most at risk will help schools and advocates better target interventions to improve student outcomes.

                </p>

            </div>
        </section>

        <section id="two_chart" class="wrapper chart">
            <div id="two_sections" class="inner">
                <div class="align-center">
                    <img class="barChart-icon" src="images/barIcon_chartArea.svg" alt="Bar Chart Icon" />
                </div>
                <div style="margin-bottom: 1.5em" class="chart"></div>
                <div></div>
                <div id="ch2_1">
                </div>
                <p style="margin-top: 1.5em;">
                    Overall, almost 20 percent of students in high school are chronically absent
                    compared to nearly 12 percent of students in middle school.
                    The chronic absenteeism rate was the lowest for elementary school students, at 10 percent.
                    For more information on how we defined grade levels, <a href="#datanotes">see the data notes</a>.
                </p></p>
                <p style="margin-bottom: 3.5em;">
                    Next, we looked at how chronic absenteeism
                    varied across grade levels for specific groups of students.
                </p>

                <p class="align-center" style="margin-top:3.5em;">View Chart By:</p>
                <div id="ch2_2">



                    <p></p>
                </div>
                <p style="margin-top:1.5em;">
                    For each subgroup of students there is a similar pattern: the likelihood of chronic absenteeism increases as students progress into high school. Notably, the stronger overall attendance observed among English learners dissipates over grade levels, such that they experience higher chronic absenteeism than their non-English learner peers when they reach high school.
                </p>

                <div></div>
            </div>
        </section>

        <!-- Three -->
        <section id="three" class="wrapper style3">
            <div class="inner">

                <h2 class="line">The Geography of Chronic Absenteeism</h2>
                <p>
                    Students experience chronic absenteeism from coast to coast. Disturbingly, nearly 500 school districts reported that 30 percent or more
                    of their students missed at least three weeks of school in 2013-14.
                </p>
            </div>
        </section>

        <section id="three_chart" class="wrapper chart">
            <div class="inner">
                <div>
                    <div class="align-center">
                        <div id="mapWrapper">
                            <div id="legend">
                                <h3><b>% of all students (K–12) who received one or more out-of-school suspension</b></h3>
                            </div>
                            <div id="selectDistrictType">
                                <div id="selectElementary" class="selected ">Elementary and Unified </div>
                                <div id="selectSecondary" class="selected ">Independent Elementary, Secondary, and Unified</div>
                            </div>
                            <div id="legendTriangle" class="triangle">&#9660;</div>
                            <div id="districtTooltip" class="districtTooltip">
                                <h3 class="stateName"></h3>
                                <h3 class="name"></h3>
                                <div class="totalAbsent"></div>
                                <div class="percentAbsent"></div>
                            </div>
                            <div id="map"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <br/>
                    <p>* <a href="#datanotes">See data notes</a>.</p>
                </div>
            </div>
        </section>

        <section id="four" class="wrapper style1">
            <div class="inner">
                <h2 class="line">Why Chronic Absenteeism Matters: What the Research Says</h2>
                <p>
                    Chronic absenteeism is
                    widespread—one out of every eight students missed three weeks or more of school in
                    2013-14. That translates to 93 million school days lost. Research suggests the reasons for chronic absenteeism are as varied as the challenges our
                    students and families face—including <a href="http://new.every1graduates.org/wp-content/uploads/2012/05/FINALChronicAbsenteeismReport_May16.pdf">
                        poor health, limited transportation, and
                        a lack of safety
                    </a>—which can be particularly acute in disadvantaged communities and <a href="http://www.attendancecounts.org/wordpress/wp-content/uploads/2010/04/Ready-2010-2.pdf">areas of poverty.</a>
                </p>
                <p style="margin-bottom: 3.5em;">Whatever its causes, chronic absenteeism can be devastating:</p>

                <ul class="callout">
                    <li>
                        <h3 class="icon style1 fa-book">Chronic absenteeism may prevent children from reaching early learning milestones.</h3>

                        <p>Children who are chronically absent in preschool, kindergarten, and first grade are <a href="https://ccsr.uchicago.edu/publications/preschool-attendance-chicago-public-schools-relationships-learning-outcomes-and-reasons">much less likely to read at grade level by the third grade</a>. Students who cannot read at grade level by the end of third grade are <a href="http://www.aecf.org/m/resourcedoc/AECF-DoubleJeopardy-2012-Full.pdf">four times more likely than proficient readers to drop out of high school.</a></p>

                    </li>
                    <li>
                        <h3 class="icon style2 fa-graduation-cap">Irregular attendance can be a better predictor of whether students will drop out before graduation than test scores.</h3>
                        <p><a href="http://www.utahdataalliance.org/downloads/ChronicAbsenteeismResearchBrief.pdf">A study of public school students in Utah</a> found that an incidence of chronic absenteeism in even a single year between 8th and 12th grade was associated with a seven-fold increase in the likelihood of dropping out.</p>
                    </li>
                    <li>
                        <h3 class="icon style3 fa-gavel">Frequent absences from school can shape adulthood.</h3>

                        <p>High school dropout, which chronically absent students are more likely to experience, has been linked to poor outcomes later in life, from poverty and <a href="http://www.econ.ucla.edu/alleras/research/books/Education_and_Health_July_2006.pdf">diminished health</a> to <a href="http://www.justicepolicy.org/images/upload/07-08_rep_educationandpublicsafety_ps-ac.pdf">involvement in the criminal justice system</a>.</p>

                    </li>
                </ul>

            </div>
        </section>

        <section class="wrapper style3">
            <div class="inner">

                <div class="socialmedia">
                    <ul class="align-right icons">
                        <li><a href="https://twitter.com/home?status=Over%206%20million%20students%20miss%2015%20days%20or%20more%20per%20school%20year.%20This%20needs%20to%20change.%20http%3A//bit.ly/ChronicAbsenteeismInAmerica%20%40usedgov" target="_blank" title="Tweet" class="fa-twitter"><span class="label">Twitter</span></a></li>
                        <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//www2.ed.gov/datastory/chronicabsenteeism.html" target="_blank" title="Share on Facebook" class="fa-facebook"><span class="label">Facebook</span></a></li>
                        <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww2.ed.gov%2Fdatastory%2Fchronicabsenteeism.html&title=Chronic%20Absenteeism%20in%20the%20Nation's%20Schools&summary=&source=http%3A%2F%2Fwww2.ed.gov%2Fdatastory%2Fchronicabsenteeism.html" target="_blank" title="Share on LinkedIn" class="fa-linkedin"><span class="label">LinkedIn</span></a></li>
                        <li><a href="mailto:?subject=Chronic%20Absenteeism%20in%20the%20Nation's%20Schools&body=:%20http%3A%2F%2Fwww2.ed.gov%2Fdatastory%2Fchronicabsenteeism.html" target="_blank" title="Email" class="fa-envelope"><span class="label">Email</span></a></li>
                    </ul>

                </div>

                <h2 class="line">The Path Forward: Every Student, Every Day</h2>
                <p>
                    The very students who tend to face
                    significant challenges and need the most educational supports
                    are often missing the most school.
                </p>

                <p>
                    When our teachers, principals, policymakers, and others
                    have access to robust data on the extent and nature of chronic
                    absenteeism, we are all in a better position to provide
                    students with the supports they need to stem this crisis in our schools.
                </p>

                <p style="margin-bottom: 3.5em;">
                    Through an array of resources, the Obama administration is
                    committed to helping ensure all our students, especially the most disadvantaged,
                    are in school every day, including:
                </p>

                <ul class="callout">
                    <li>
                        <h3 class="icon style1 fa-bus"><a href="http://www2.ed.gov/about/inits/ed/chronicabsenteeism/index.html">Every Student, Every Day: A national initiative to address and eliminate chronic absenteeism.</a></h3>
                        <p>Supports coordinated community action that addresses the underlying causes of local chronic absenteeism affecting millions of children in our nation's public schools each year.</p>
                    </li>
                    <li>
                        <h3 class="icon style2 fa-trophy"><a href="https://www.whitehouse.gov/my-brothers-keeper">My Brother's Keeper Success Mentor Initiative: An evidence-based, data-driven approach to close the opportunity gap and drive school success for more of our nation's students.</a></h3>
                        <p>The My Brother’s Keeper (MBK) Success Mentors Initiative is the nation’s first-ever effort to reach and support more of our nation’s highest-need students by scaling an evidence-based, data-driven mentor model through our schools. Over the next three to five years, the initiative aims to reduce chronic absenteeism and drive school success by connecting chronically absent students to caring, trained adults who can serve as mentors.</p>
                    </li>
                    <li>
                        <h3 class="icon style3 fa-table"><a href="http://www2.ed.gov/about/offices/list/ocr/docs/crdc-2013-14.html">The Civil Rights Data Collection (CRDC): A biennial survey required by the Department’s Office for Civil Rights since 1968.</a></h3>
                        <p>The CRDC shines a spotlight on data that enable us to understand the successes and challenges of schools and school districts in providing educational opportunity to all of our nation’s children.</p>
                    </li>
                </ul>

            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer id="footer" class="wrapper style1-alt">
        <div class="inner align-center">
            <div class="6u$ 12u$(medium) dataExclusion">
                <h3 id="datanotes" class="line">Data Exclusion Rules</h3>
                <p>Data included in this story may differ slightly from other published reports due to certain data decisions. For the purposes of these analyses, schools with incomplete or inconsistent data values were excluded. Less than 5% of schools were excluded for the following reasons:</p>
                <ol>
                    <li>
                        The chronic absenteeism question was not applicable to the school
                        (the school must have students enrolled in grades K–12).
                    </li>
                    <li>
                        The school reported incomplete data for enrollment and/or
                        the chronic absenteeism count for at least one race/ethnicity subgroup.
                    </li>
                    <li>
                        The chronic absenteeism count was larger than the K–12
                        enrollment for at least one race/ethnicity subgroup. Schools with partial or missing data for students with disabilities or English learners were included in all analyses except those that focused on these subgroups.
                    </li>
                </ol>
            </div>

            <div class="6u$ 12u$(medium) dataExclusion">
                <h3 style="font-size: 15px;" class="line">Grade Level Definitions</h3>
                <p>School grade levels were defined using the National Center for Education Statistics (NCES) definition: elementary schools are those in which the lowest grade offered is PK through grade 3 and the highest is PK through grade 8, middle schools are those in which the lowest grade offered is grade 4 through grade 7 and the highest is grade 4 through grade 9, high schools are those in which the lowest grade offered is grade 7 through grade 12 and the highest is grade 12, other schools are those with any other configuration that does not fall within the previous three categories.</p>
            </div>

            <div class="6u$ 12u$(medium) dataExclusion">
                <h3 style="font-size: 15px;" class="line">Map Notes</h3>
                <p>Data might be missing from the chronic absenteeism map if:</p>
                <ol>
                    <li>A district did not report chronic absenteeism data or the data were inconsistent.</li>
                    <li>A district that reported chronic absenteeism data did not match with the NCES district boundary file.</li>
                    <li>District boundaries overlapped and we could not associate reported data with a unique district boundary.</li>
                </ol>
            </div>

        </div>

    </footer>


    <!-- D3 charts -->
    <script src="assets/js/d3.v3.min.js"></script>
    <script src="assets/js/d3-tip.js"></script>
    <script src="assets/js/chart-functions.js"></script>
    <script src="assets/js/graph-scroll.js"></script>

    <script>

        // chapter 1 charts

        d3.tsv("assets/data/data.tsv", function (error, data) {
            if (error) { console.log(error); }
            else {
                data.forEach(function (d) {
                    d.var1 = d.group; // This is the subgroup
                    d.var2 = +d.number; // This is the raw number
                    d.var3 = +d.pct; // This is the percentage
                    d.subchart = +d.subchart;
                    d.var4 = d.level;
                });

                data1_2 = data.filter(function (d) { return d.chart == "1-2"; })
                data1_3 = data.filter(function (d) { if ((d.chart == "1-3") || (d.chart == "1-4") || (d.chart == "1-5")) { return d; } });
                // data1_4 = data.filter(function(d) { return d.chart == "1-4"; });
                // data1_5 = data.filter(function(d) { return d.chart == "1-5"; });

                // var chart1_1 = donutChart().data(data1_1).title("students were chronically absent in 2013-14"); // Chapter 1-1
                var chart1_2 = barChart().marginLeft(150).data(data1_2).containerID("one_chart").subcontainerID("one_sections").sectionID("ch1_2").chartID("chart1_2")
					.title("While prevalent across the country, students of different races and ethnicities experience chronic absenteeism at different rates.")
					.altText("This chart illustrates the percentage of students, by race or ethnicity, who were chronically absent in 2013-14."); // Chapter 1 - 2
                var chart1_3 = groupedCol().data(data1_3).containerID("one_chart").subcontainerID("one_sections").sectionID("ch1_3").chartID("chart1_3").title1("Chronic absenteeism is 22% less likely among English learners than non-English learners.").title2("Students with disabilities are 34% more likely to be chronically absent than students without disabilities.").title3("Overall, chronic absenteeism does not differ significantly by gender."); // Chapter 1 - 3
                //var chart1_4 = barChart().marginLeft(150).data(data1_4).containerID("one_chart").subcontainerID("one_sections").sectionID("ch1_4").chartID("chart1_4"); // Chapter 1 - 4
                //var chart1_5 = colChart().data(data1_5).containerID("one_chart").subcontainerID("one_sections").sectionID("ch1_5").chartID("chart1_5"); // Chapter 1 - 5

                d3.select("#ch1_2").call(chart1_2);
                d3.select("#ch1_3").call(chart1_3);
                // d3.select("#ch1_4").call(chart1_4);
                // d3.select("#ch1_5").call(chart1_5);

            };
        });

        // chapter 2-1

        d3.tsv("assets/data/data.tsv", function (error, data) {
            if (error) { console.log(error); }
            else {
                data.forEach(function (d) {
                    d.var1 = d.level;
                    d.var2 = +d.number;
                    d.var3 = +d.pct;
                });

                data = data.filter(function (d) { return d.chart == "2-1"; });

                var chart2_1 = dotPlot().data(data).containerID("two_chart").subcontainerID("two_sections").sectionID("ch2_1").chartID("chart2_1").title("Nearly 1 in 5 students in high school are chronically absent.");

                d3.select("#ch2_1").call(chart2_1);

            }
        });

        // chapter 2-2

        d3.tsv("assets/data/data.tsv", function (error, data) {
            if (error) { console.log(error); }
            else {
                data.forEach(function (d) {
                    d.number = +d.number;
                    d.pct = +d.pct;
                });

                data0 = data.filter(function (d) { return d.chart == "2-2"; });

                var chart2_2 = groupedBar().data(data0).marginLeft(150).animateTime(750).containerID("two_chart").subcontainerID("two_sections").sectionID("ch2_2").chartID("chart2_2")
                    .title1("Chronic absenteeism spikes in high school for students of every race and ethnicity.")
                    .title2("Females are slightly more likely to be chronically absent in high school than males.")
                    .title3("Students with disabilities face a greater risk of chronic absenteeism at every grade level.")
                    .title4("English learners are less likely to be chronically absent at every grade level except for high school.");

                d3.select("#ch2_2").call(chart2_2);

            }
        });

        // D3 MAP SCALE
        var triangle = d3.select("#legendTriangle")
                .style("opacity", 0);
        var scaleSVG = d3.select("#legend").append("svg").attr("height", 50);
        var scale = scaleSVG.append("g")
                .attr("class", "scale")
                .attr("class", "key")
                .attr("transform", "translate(25,0)");
        var formatNumber = d3.format(",d");
        var color = d3.scale.threshold()
                .domain([0, 3, 6, 12])
                .range(["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"]);
        var xKey = d3.scale.linear()
                .domain([-5, 15])
                .range([0, 250]);

        var xAxis = d3.svg.axis()
                .scale(xKey)
                .orient("bottom")
                .tickSize(25)
                .tickValues(color.domain())
                .tickFormat(function (d) {
                    return d >= 0 ? formatNumber(d) : null;
                });

        scale.selectAll("rect")
                .data(color.range().map(function (d, i) {
                    return {
                        x0: i ? xKey(color.domain()[i - 1]) : xKey.range()[0],
                        x1: i < color.domain().length ? xKey(color.domain()[i]) : xKey.range()[1],
                        z: d
                    };
                })).enter().append("g")
                .append("rect")
                .attr("height", 15)
                .attr("x", function (d) {
                    return d.x0;
                })
                .attr("width", function (d) {
                    return d.x1 - d.x0;
                })
                .attr("data-metric", function (d) {
                    return d.z;
                })
                .style("fill", function (d) {
                    return d.z;
                })
                .style("margin", 1);

        scale.call(xAxis).append("text")
                .attr("class", "caption")
                .attr("y", -6)
                .text("Absent per District");

        scaleSVG.selectAll("rect")
                .on("mouseover", function () {
                    var item = d3.select(this);
                    if (!item.classed("scaleSelect")) {
                        var itemColor = item.attr("data-metric");
                        svg.selectAll(".district")
                                .attr("fill", function (d) {
                                    if(d.properties["OOS Group"] != "Null or Missing Data") {
                                        if(itemColor == colorByGroup(d.properties["Percent OOS"])){
                                            return itemColor;
                                        }else{
                                            return "lightgray";
                                        }
                                    }
                                    else{
                                        if(itemColor == colorByGroup(d.properties["OOS Group"])){
                                            return itemColor;
                                        }else{
                                            return "lightgray";
                                        }
                                    }
                                });
                        svg.selectAll(".secondaryDistrict")
                                .attr("fill", function (d) {
                                    if(d.properties["Absent Group"] != "Null or Missing Data") {
                                        if(itemColor == colorByGroup(d.properties["Percent OOS"])){
                                            return itemColor;
                                        }else{
                                            return "lightgray";
                                        }
                                    }
                                    else{
                                        if(itemColor == colorByGroup(d.properties["OOS Group"])){
                                            return itemColor;
                                        }else{
                                            return "lightgray";
                                        }
                                    }
                                });
                    }
                }).on("mouseout", function () {
            var item = d3.select(this);
            if (!item.classed("scaleSelect")) {
                updateColors();
            }
        }).on("click", function () {
            var triangleCoord = this.getBoundingClientRect();
            triangle.style("left", ((triangleCoord.left + triangleCoord.right)/2  - 320) + "px")
            .style("top", (triangleCoord.top -320) + "px");

            var item = d3.select(this);
            if (item.classed("scaleSelect")) {
                item.attr("class", "");
                triangle.style("opacity",0);
                updateColors();
            } else {
                item.attr("class", "scaleSelect");
                //triangle.style("opacity",1);
                var itemColor = item.attr("data-metric");
                svg.selectAll(".district")
                        .attr("fill", function (d) {
                            if(d.properties["Absent Group"] != "Null or Missing Data") {
                                if(itemColor == colorByGroup(d.properties["Percent OOS"])){
                                    return itemColor;
                                }else{
                                    return "lightgray";
                                }
                            }
                            else{
                                if(itemColor == colorByGroup(d.properties["OOS Group"])){
                                    return itemColor;
                                }else{
                                    return "lightgray";
                                }
                            }
                        });

                svg.selectAll(".secondaryDistrict")
                        .attr("fill", function (d) {
                            if(d.properties["OOS Group"] != "Null or Missing Data") {
                                if(itemColor == colorByGroup(d.properties["Percent OOS"])){
                                    return itemColor;
                                }else{
                                    return "lightgray";
                                }
                            }
                            else{
                                if(itemColor == colorByGroup(d.properties["OOS Group"])){
                                    return itemColor;
                                }else{
                                    return "lightgray";
                                }
                            }
                        });
            }
        });

        //  D3 MAP
        var width = 960;
        var height = 600;
        var center = [width / 2, height / 2];
        var defaultFill = "lightgray";

        var projection = d3.geo.albersUsa();

        var path = d3.geo.path()
                .projection(projection);

        var zoom = d3.behavior.zoom()
                .scaleExtent([1, 8])
                .on("zoom", move);

        var svg = d3.select("#map").append("svg")
                .attr("preserveAspectRatio", "xMinYMin meet")
                .attr("viewBox", "0 0 " + width + " " + height)
                .classed("svg-content-responsive", true)
                .append("g")
                .call(zoom);
        svg.on("wheel.zoom", null);
        svg.on("mousewheel.zoom", null);

        svg.append("svg:image")
                .attr("xlink:href", "images/progress-anim.gif")
                .attr("id", "progress-image")
                .attr("width", 43)
                .attr("height", 11)
                .attr("x", width / 2)
                .attr("y", height / 2)
                .style("opacity",1);

        var g = svg.append("g");

        var tooltip = d3.select("#districtTooltip")
                .attr("class", "districtTooltip")
                .style("opacity", 0);

        queue()
                .defer(d3.json, "assets/data/us.json")
                .defer(d3.json, "assets/data/elementary_unified.json")
                .defer(d3.json, "assets/data/secondary.json")
                .await(ready);

        function ready(error, us, primary, secondary) {
            if (error) { console.log(error);}
            g.append("g")
                    .selectAll("path")
                    .data(topojson.feature(primary, primary.objects.medium_G5420_G5400).features)
                    .enter().append("path")
                    .attr("class", "district")
                    .attr("d", path)
                    .attr("stroke", "#fff")
                    .attr("stroke-opacity", .15)
                    .attr("stroke-linejoin", "round")
                    .on("mouseover", function (d) {
                        var districtCoord = this.getBoundingClientRect();

                        d3.select(this).attr("stroke", "#1A1C20")
                                .attr("stroke-opacity",1)
                                .attr("stroke-width",.5);
                        d3.select(this).classed("selected", true);

                        tooltip.transition().duration(100).style("opacity", 1);

                        var mapWidth = parseFloat(d3.select(".svg-content-responsive").style("width"));
                        var mapHeight = parseFloat(d3.select(".svg-content-responsive").style("height"));


                        if (d3.event.pageX > (mapWidth - $('#sidebar').width())) {
                            tooltip.style("left", (districtCoord.left - 500) + "px");
                        } else {
                            tooltip.style("left", (districtCoord.left - 250) + "px");
                        }
                        if (districtCoord.top < (mapHeight/2)) {
                            tooltip.style("top", (districtCoord.top + 150) + "px");
                        } else {
                            tooltip.style("top", (districtCoord.top - 30) + "px");
                        }

                        tooltip.select(".stateName").text(d.properties["State"]);
                        tooltip.select(".name").text(d.properties.Name);
                        if(d.properties["Percent OOS"] != null) {
                            tooltip.select(".totalAbsent").text("Total OOS: " + d.properties["Total OOS"]);
                            tooltip.select(".percentAbsent").text("Percent OOS: " + d.properties["Percent OOS"]);
                        }else{
                            tooltip.select(".totalAbsent").text("Total OOS: NO DATA");
                            tooltip.select(".percentAbsent").text("Percent OOS: NO DATA");
                        }
                    })
                    .on("mouseout", function () {
                        d3.select(this).attr("stroke", "#fff")
                                .attr("stroke-opacity", .15)
                                .attr("stroke-width",.2);
                        d3.select(this).classed("selected", false);
                        tooltip.transition().duration(300)
                                .style("opacity", 0);
                    });

            g.append("g")
                    .attr("class", "states")
                    .selectAll("path")
                    .data(topojson.feature(us, us.objects.states).features)
                    .enter().append("path")
                    .attr("class", "state")
                    .attr("d", path);

            d3.select("#selectElementary").on("click", function () {
                d3.select("#selectSecondary").style("background", "white");
                d3.select(this).style("background", "yellow");
                d3.selectAll("#secondaryDistrict").remove();
            });

            d3.select("#selectSecondary").on("click", function () {
                d3.selectAll(".state").remove();
                d3.select("#selectElementary").style("background", "white");
                d3.select(this).style("background", "yellow");
                g.append("g")
                        .selectAll("path")
                        .data(topojson.feature(secondary, secondary.objects.medium_G5410).features)
                        .enter().append("path")
                        .attr("id","secondaryDistrict")
                        .attr("class", "district")
                        .attr("d", path)
                        .attr("stroke", "#fff")
                        .attr("stroke-opacity", .15)
                        .attr("stroke-linejoin", "round")
                        .on("mouseover", function (d) {
                            var coordinates = [0, 0];
                            coordinates = d3.mouse(this);
                            var districtCoord = this.getBoundingClientRect();
                            var y = coordinates[1];

                            d3.select(this).attr("stroke", "#1A1C20")
                                    .attr("stroke-opacity",1)
                                    .attr("stroke-width", .5);
                            d3.select(this).classed("selected", true);

                            tooltip.transition().duration(100).style("opacity", 1);
                            var mapWidth = parseFloat(d3.select(".svg-content-responsive").style("width"));
                            var mapHeight = parseFloat(d3.select(".svg-content-responsive").style("height"));

                            if (d3.event.pageX > (mapWidth - $('#sidebar').width())) {
                                tooltip.style("left", (districtCoord.left - 500) + "px");
                            } else {
                                tooltip.style("left", (districtCoord.left - 250) + "px");
                            }
                            if (y < (mapHeight/3)) {
                                tooltip.style("top", (districtCoord.top + 100) + "px");
                            } else {
                                tooltip.style("top", (districtCoord.top - 100) + "px");
                            }

                            tooltip.select(".stateName").text(d.properties["State"]);
                            tooltip.select(".name").text(d.properties.Name);
                            tooltip.select(".totalAbsent").text("Total OOS: " + d.properties["Total OOS"]);
                            tooltip.select(".percentAbsent").text("Percent OOS: " + d.properties["Percent OOS"]);
                        })
                        .on("mouseout", function () {
                            d3.select(this).attr("stroke", "#fff")
                                    .attr("stroke-opacity", .15)
                                    .attr("stroke-width",.2);
                            d3.select(this).classed("selected", false);
                            tooltip.transition().duration(300)
                                    .style("opacity", 0);
                        });
                updateColors();
                g.append("g")
                        .attr("class", "states")
                        .selectAll("path")
                        .data(topojson.feature(us, us.objects.states).features)
                        .enter().append("path")
                        .attr("class", "state")
                        .attr("d", path);
            });

            // Zoom buttons
            svg.selectAll(".button")
                    .data(['zoom_in', 'zoom_out'])
                    .enter()
                    .append("g")
                    .attr("id", function (d) {
                        return d
                    })
                    .attr("class", "button")
                    .attr({x: 20, width: 20, height: 20})
                    .append("rect")
                    .attr("y", function (d, i) {
                        return 20 + 25 * i
                    })
                    .attr({x: 20, width: 20, height: 20});

            // Plus button
            svg.select("#zoom_in")
                    .append("line")
                    .attr({x1: 25, y1: 30, x2: 35, y2: 30})
                    .attr("stroke", "#fff")
                    .attr("stroke-width", "2px");
            svg.select("#zoom_in")
                    .append("line")
                    .attr({x1: 30, y1: 25, x2: 30, y2: 35})
                    .attr("stroke", "#fff")
                    .attr("stroke-width", "2px");

            // Minus button
            svg.select("#zoom_out")
                    .append("line")
                    .attr({x1: 25, y1: 55, x2: 35, y2: 55})
                    .attr("stroke", "#fff")
                    .attr("stroke-width", "2px");

            svg.selectAll(".button")
                    .on("click", function () {
                        d3.event.preventDefault();

                        var scale = zoom.scale(),
                                extent = zoom.scaleExtent(),
                                translate = zoom.translate(),
                                x = translate[0], y = translate[1],
                                factor = (this.id === 'zoom_in') ? 2 : 1 / 2,
                                target_scale = scale * factor;

                        var clamped_target_scale = Math.max(extent[0], Math.min(extent[1], target_scale));
                        if (clamped_target_scale != target_scale) {
                            target_scale = clamped_target_scale;
                            factor = target_scale / scale;
                        }

                        // Center each vector, stretch, then put back
                        x = (x - center[0]) * factor + center[0];
                        y = (y - center[1]) * factor + center[1];

                        // Transition to the new view over 350ms
                        d3.transition().duration(350).tween("zoom", function () {
                            var interpolate_scale = d3.interpolate(scale, target_scale),
                                    interpolate_trans = d3.interpolate(translate, [x, y]);
                            return function (t) {
                                zoom.scale(interpolate_scale(t))
                                        .translate(interpolate_trans(t));
                                svg.call(zoom.event);
                            };
                        });
                    });
            updateColors();
            svg.select("#progress-image").style("opacity",0);
        }

        function updateColors() {
                svg.selectAll(".district")
                        .attr("fill", function (d) {
                            return colorByGroup(d.properties["Percent OOS"]);
                        });
                svg.selectAll(".secondaryDistrict")
                        .attr("fill", function (d) {
                                return colorByGroup(d.properties["Percent OOS"]);
                        });
        }

        function colorByGroup(p) {

                var d = isNaN(parseFloat(p)) ? -1 : parseFloat(p);
                return d == 0 ? '#f2f0f7' :
                        (d > 0 && d <= 3) ? '#cbc9e2' :
                                (d > 3 && d <= 6) ? '#9e9ac8' :
                                        (d > 6 && d <= 12) ? '#756bb1' :
                                                (d > 12) ? '#54278f' :
                                                        (d < 0) ?  'gray' :
                                                                defaultFill;
        }

        function zoomIn() {
            zoom.scale(zoom.scale() * 2);
            move();
        }

        function move() {
            var t = d3.event.translate,
                    s = d3.event.scale;
            t[0] = Math.min(width * (s - 1), Math.max(width * (1 - s), t[0]));
            t[1] = Math.min(height * (s - 1), Math.max(height * (1 - s), t[1]));
            zoom.translate(t);
            g.style("stroke-width", 1 / s).attr("transform", "translate(" + t + ")scale(" + s + ")");
        }

        function clicked(d) {
            var x, y, k;
            var centered;
            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 4;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
            }

            g.selectAll("path")
                    .classed("active", centered && function (d) {
                                return d === centered;
                            });

            g.transition()
                    .duration(750)
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                    .style("stroke-width", 1.5 / k + "px");
        }

        function removeFromArray(arr) {
            var what, a = arguments, L = a.length, ax;
            while (L > 1 && arr.length) {
                what = a[--L];
                while ((ax = arr.indexOf(what)) !== -1) {
                    arr.splice(ax, 1);
                }
            }
            return arr;
        }
        d3.select(self.frameElement).style("height", height + "px");
    </script>
</body>
</html>
